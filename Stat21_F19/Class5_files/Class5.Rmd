---
title: "Class 5"
subtitle: "STAT 021"
author: "Suzanne Thornton"
institute: "Swarthmore College"
date: "2019/9/11 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader: 
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
  includes:
    in header: STteachingMarkdown.sty    
---

```{r setup_pres, include=FALSE, echo=FALSE}
rm(list=ls())
library('tidyverse')
library('gridExtra')
library('broom')
library('cowplot')

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.height=4, fig.path='Figs/',
                      echo=TRUE, warning=FALSE, message=FALSE)
```

```{css, echo=FALSE}
pre {
  background: #FFBB33;
  max-width: 100%;
  overflow-x: scroll;
}
```




```{r, echo=FALSE, fig.align='center', fig.keep='all'}
knitr::include_graphics("Figs/unreachable_state.png")
```

.footnote[Source: https://xkcd.com/2200/]

---

# Topics covered in today's lecture

  - Answering statistical questions about the body temperature data
  - Determining normality with Quantile-Quantile (QQ) plots


---
# Body temperature dataset

```{r import_data, echo=FALSE, warning=FALSE, fig.keep='all'}
rm(list = ls())
#install.packages("tidyverse") ##should also install the dependencies "ggplot2" (for visualizing data) and "margrittr" (for piping)
library("tidyverse")
body_temp_dat <- read_table2("normtemp_data.txt", 
                        col_types = list(col_double(),col_character(),col_double()))
body_temp_dat %>% head() 
```

---
# Useful ways to manipulate data<sup>1</sup>

Commonly used data manipulation functions
  - *select()*
  - *filter()*
  - *mutate()*
  - *group_by()*
  - *summarize()*
  - *count()* 

  
.footnote[1 https://datacarpentry.org/R-ecology-lesson/03-dplyr.html#selecting_columns_and_filtering_rows]  

---
# Visualizing data in R with *ggplot2*

Does the data look normally distributed? 


```{r, figDensity, echo=TRUE, warning=FALSE, message=FALSE, fig.height = 3.5, fig.width = 10, fig.align = 'center',fig.keep='all'}
body_temp_plot <- ggplot(data=body_temp_dat, aes(Temperature)) 
                         
p1 <- body_temp_plot + geom_histogram()  
p2 <- body_temp_plot + geom_density()

#install.packages("cowplot") ##requires R version >= 3.5.0  
library("cowplot")
plot_grid(p1, p2, align = "h", nrow = 1, rel_widths = c(1/2, 1/2))
```


---
# The most useful statistical summaries 

Measure of "location"
  
  - Mean: sometimes this does not exist! 
  
  - Median
  
  - Mode
  
  - Plots! 
  
Measures of "spread" (or "scale") 
  
  - Standard deviation: sometimes this is infinite! (e.g. Cauchy distribution)
  
  - Interquartile range
  
  - Minimum and maximum
  
  - Plots! 


---

# Variance and standard deviation 

  - Standard deviation is a *standard* unit of measurement for Statisticians. Always specify, the standard deviation *of what?*. Otherwise, we have no idea what kind of data we are studying since standard deviation is unit-less! 

  - Variance is just a function of standard deviation. The same rules apply.

  - Standard error is a related concept; it is the standard deviation of the **estimate** for the parameter of interest.<sup>[1]</sup> 

--


Standard error gives us a measurement of uncertainty about a parameter and thus is used in constructing confidence intervals for that parameter. 

Standard deviation on the other hand is a property of the data. 


.footnote[[1] https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3148365/
]


---
# Analyze body temp data

  Is the true population mean really 98.6 degrees F? 
  
```{r figDensity2, echo=TRUE, warning=FALSE, fig.height = 4, fig.width = 10, fig.align = 'center',fig.keep='all'}
body_temp_plot + geom_density() + 
                 geom_vline(xintercept=98.6, col="red")
```




---
# Analyze body temp data

For fun: what does a Cauchy density (green) look like in comparison to the data (black) or to a normal density (blue)? (Remember the Cauchy distribution has no finite mean or standard deviation.) 

```{r figDensity3, echo=FALSE, warning=FALSE, fig.height = 4, fig.width = 10, fig.align = 'center',fig.keep='all'}
ggplot() + geom_density(data=body_temp_dat, aes(Temperature)) + 
                 xlim(80, 120) +
                 geom_density(aes(rnorm(130, 98, 0.7)), col="blue") +
                 geom_density(aes(rcauchy(130, 98, 0.7)), col="green")
```


---
# Analyze body temp data

At what temperature should we consider someone's temperature to be "abnormal"? 
--


To answer this question, we need a measurement of deviation for the temperature data. 

```{r echo=TRUE, warning=FALSE}
sd(body_temp_dat$Temperature)

var(body_temp_dat$Temperature)
```

---
# Analyze body temp data

What if we look at body temperature in degrees Celsius? 

```{r echo=TRUE, warning=FALSE}
body_temp_dat2 <- body_temp_dat %>% 
                      mutate(CelciusTemp = ((Temperature-32)*5)/9)

sd(body_temp_dat2$CelciusTemp)
var(body_temp_dat2$CelciusTemp)
```

--
What we see here is that measurements of spread (standard deviation and variance) **depend** on the units of the data. 


---
# Analyze body temp data

How could I make it so that these values would **not change** depending on the units of my data? 


To *standardize* data points, take the original data set 
$$x_{obs} = (x_{1}, x_{2}, \dots, x_{n}),$$
and subtract the mean and divide by the sample standard deviation to get **unitless** data points

$$z_{obs} = \left(\frac{x_{1}-\bar{x}}{s},\frac{x_{2}-\bar{x}}{s}, \dots, \frac{x_{n}-\bar{x}}{s}  \right).$$
Let's prove this!    
   
---
# Analyze body temp data


In R, we create two new columns for the *standardized* Celsius and Fahrenheit temperatures and see that they are the same now because the data is unit-less! 

```{r echo=TRUE, warning=FALSE}
body_temp_dat3 <- body_temp_dat2 %>% 
                      mutate(StandardizedTempFah = ((Temperature-mean(Temperature))/sd(Temperature)),
                             StandardizedTempCel = ((CelciusTemp-mean(CelciusTemp))/sd(CelciusTemp)))

print(body_temp_dat3[1:6,5:6])
```   
 

---
# Analyze body temp data

Is the true population mean really 98.6 degrees F? 
  
```{r echo=TRUE, warning=FALSE}
    t.test(body_temp_dat$Temperature, alternative="two.sided", mu=98.6, conf.level=0.95)

```

  

---
# Analyze body temp data

What would be the conclusion of a hypothesis test on the temperature in degrees *Celcius*? That is, what is our conclusion to the question: is the true population mean really 37 degrees Celsius? 
  
```{r echo=TRUE, warning=FALSE}
    t.test(body_temp_dat2$CelciusTemp, alternative="two.sided", mu=37, conf.level=0.95)

```  
  
---
# Analyze body temp data

Comparing the output of each of these t-tests for body temperature in Fahrenheit and Celsius we note the following:


.pull-left[
Things that **do not** depend on the unit of the data
  - t test statistic
  - degrees of freedom
  - critical t-value
  - p-value.]

.pull-right[Things that **do** depend on the units 
  - confidence interval 
  - null hypothesis value
  - sample estimates (mean and standard deviation).]

    
---
# Analyze body temp data
    
Is there a significant difference in average body temperature based on whether or not a person is right handed? 

```{r echo=TRUE, warning=FALSE}
body_temp_dat_hand1 <- body_temp_dat %>% filter(Handedness==1) 
body_temp_dat_hand2 <- body_temp_dat %>% filter(Handedness==2) 

t.test(x=body_temp_dat_hand1$Temperature, y=body_temp_dat_hand2$Temperature, 
       alternative="two.sided", paired=FALSE, mu=0, conf.level=0.95)

```

---
# Analyze body temp data
    
Is there a significant difference in average body temperature based on whether or not a person is right handed? 

```{r echo=FALSE, warning=FALSE}
body_temp_dat_hand1 <- body_temp_dat %>% filter(Handedness==1) 
body_temp_dat_hand2 <- body_temp_dat %>% filter(Handedness==2) 

t.test(x=body_temp_dat_hand1$Temperature, y=body_temp_dat_hand2$Temperature, 
       alternative="two.sided", paired=FALSE, mu=0, conf.level=0.95)

```
Question: Why aren't we using a paired t-test? 

--

Another question: What would our p-value be if we conducted this same test of the difference of means on the data set with temperature recorded in Celsius instead?


---
# Analyze body temp data

Is there a relationship between body temperature and heart rate? 

```{r figScatterplot, echo=TRUE, warning=FALSE, fig.height = 4, fig.width = 10, fig.align = 'center', fig.keep='all'}
body_temp_plot <- ggplot(data=body_temp_dat, aes(x=Temperature, y=HeartRate)) +
  geom_point()
body_temp_plot                        
```

--
This is the kind of question we will be investigating in this class. To do this, we need to understand how to build statistical models.... 


---
# A review of important statistical concepts

Suppose we observe $n$ data points and, for each data point, we collect two measurements, one for variable $X$ (e.g. age) and another for variable $Y$ (e.g height). 

<ol start="1">

<li> Expectation, variance, covariance</li></ol>

$$E[X] \approx \frac{1}{n}\sum_{i=1}^{n} x_{i}$$
---
# A review of important statistical concepts

Suppose we observe $n$ data points and, for each data point, we collect two measurements, one for variable $X$ (e.g. age) and another for variable $Y$ (e.g height). 

<ol start="1">

<li> Expectation, variance, covariance</li></ol>
$$Var[X] = Cov[X, X] = E[(X-E[X])^2] = \dots = (E[X])^2 - E[X^2]$$ 
$$\approx \frac{1}{n-1}\sum_{i=1}^{n}\left(x_{i}-\frac{1}{n}\sum_{i=1}^{n}x_{i}\right)^2$$
--
$$Cov[X, Y] = E[(X-E[X])(Y-E[Y])] = \dots = E[XY] - E[X]E[Y]$$ 
$$\approx   \frac{1}{n-1}\sum_{i=1}^{n}\left(x_{i}-\frac{1}{n}\sum_{i=1}^{n}x_{i}\right)\left(y_{i}-\frac{1}{n}\sum_{i=1}^{n}y_{i}\right)$$

---
# A review of important statistical concepts

Suppose we observe $n$ data points and, for each data point, we collect two measurements, one for variable $X$ (e.g. age) and another for variable $Y$ (e.g height). 

<ol start="2">
<li>Independence and Correlation</li></ol>

Correlation is a standardized version of covariance: 

$$\rho(X,Y) = Corr(X,Y) = \frac{Cov[X,Y]}{\sqrt{Var[X]Var[Y]}}.$$

--      

If two RVs are independent, then they are uncorrelated. NOT vice versa! If $X$ is independent of $Y$ then $E[XY] = E[X]E[Y]$ and thus $Cov[X, Y] = 0$ and subsequently $Corr[X,Y] = 0$. 



---
# A review of important statistical concepts

Suppose we observe $n$ data points and, for each data point, we collect two measurements, one for variable $X$ (e.g. age) and another for variable $Y$ (e.g height). 


<ol start="3">
<li>Null hypothesis, test statistic, Type I and Type II errors</li>
  <ul><li>Boy who cried wolf story</li></ul>

<li>Connection between confidence intervals and hypothesis tests</li></ol>
  




