---
title: "Exam 2"
subtitle: "STAT 021"
author: "Swarthmore College"
date: "2019/11/22"
output: pdf_document 
---

```{r setup_pres, include=FALSE, echo=FALSE}
rm(list=ls())
library('tidyverse')
library('gridExtra')
library('broom')
library('cowplot')

#setwd("~/Google Drive Swat/Swat docs/Stat 21/Data")
options(htmltools.dir.version = FALSE)
```

```{css, echo=FALSE}
pre {
  background: #FFBB33;
  max-width: 100%;
  overflow-x: scroll;
}
```


\begin{flushright}Name: $\underline{\hspace{5cm}}$ \end{flushright}



**Instructions:** 

There are seven questions on this exam. The points allotted for each question are given at the end of the problem. Please don't write an entire page response for any of the answers. Rather, answer these questions to the best of your ability with succinct, informative statements or observations. You may or may not use the following formulas and definitions.  



**Formulas and Definitions**
To standardize a vector of numerical variables (say $w_1, w_2, \dots w_n$) we subtract the mean and divide by the standard deviation for each value; e.g. $z_i = \frac{w_i - a}{b}$, where 
$$a = \bar{w} = \frac{1}{n}\sum_{i=1}^{n} w_i \quad \text{ and }\quad b=\frac{1}{n-1} \sum_{i=1}^{n}(w_i - \bar{w})^2.$$

Linear model with $p$ predictor variables: $Y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \dots + \beta_p x_p + \epsilon$.


In the model above, if we assume that the mean of $\epsilon$ is $0$ and the variance of $\epsilon$ is some unknown number, $\sigma^2$, then the mean of the random variable $Y$ is $\beta_0 + \beta_1x_1 + \dots + \beta_p x_p$ and the variance of $Y$ is $\sigma^2$.


Fitted/estimated model: $\hat{y} = \hat{\beta}_0 + \hat{\beta}_1 x_1 + \hat{\beta}_2 x_2 + \cdots + \hat{\beta}_p x_p$


In the fitted model above, the values for each $\hat{\beta}_j$, $j=1,\dots, p$, are functions of $Y$ that minimize the distance from the regression line (plane) to the data points ($y_{obs}$). 


Definition of residuals: $\hat{y} - y = e$


Regression model sums of squares: $\sum_{i=1}^{n}(\hat{y}_i-\bar{y})^2$ 


Residual sums of squares: $\sum_{i=1}^{n}(y_i - \hat{y}_i)^2$ 


Total sums of squares: $\sum_{i=1}^{n}(y_i - \bar{y})^2$ 


Relationship among the sums of squares terms: $SS_{tot} = SS_{reg} + SS_{res}$

The sums of squares terms are used to calculate the following statistics: 

$$\hat{\sigma} = \sqrt{\frac{SS_{res}}{n-2}}$$ 

$$R^2 = 1-\frac{SS_{res}}{SS_{tot}} = \frac{SS_{reg}}{SS_{tot}}$$ 

We can calculate the correlation between two vectors $(x_1, \dots, x_n)$ and $(y_1, \dots, y_n)$ with the formula
$$Cor(x,y) = \frac{\sum_{i=1}^{n}(x_i - \bar{x})(y_i- \bar{y})}{\sqrt{\sum_{i=1}^{n}(x_i - \bar{x})^2\sum_{i=1}^{n}(y_i - \bar{y})^2}}$$

\newpage

**Problem 1**

The R-output below contains the results from a regression model fit to a dataset concerning life expectancy in years, alcohol consumption in drinks per day, and smoking status (smoker - Yes vs. non-smoker - No). (35 points) 
 

```{r echo=TRUE, eval=FALSE}
## Call:
## lm(formula = Lifespan ~ Alcohol + Smoker)
 
## Residuals:
## Min 1Q Median 3Q Max
## -30.796 -7.139 0.125 6.949 19.578
 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)
## (Intercept) 93.6818  2.1024     44.56   <2e-16 ***
## Alcohol     -3.2656  0.3147    -10.38   <2e-16 ***
## SmokerYes  -23.4392  1.9922    -11.77   <2e-16 ***
## ---
## Signif. codes: 0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
## Residual standard error: 9.959 on 97 degrees of freedom
## Multiple R-squared: 0.7129, Adjusted R-squared: 0.7069
## F-statistic: 120.4 on 2 and 97 DF, p-value: < 2.2e-16
``` 
 
Answer the following questions pertaining to the output above.


a) How does drinking alcohol affect average life expectancy?

Each additional drink per day decreases life expectancy by 3.2656 years on average.


b) Suppose the mean alcohol consumption in both groups combined is 2.5 drinks per day. Calculate (provide the formula for) the estimate of the average life expectancy for **non-smokers**.

$93.6818 - 3.2656 \times 2.5 = 85.5178$


c) What is the average difference in lifespan between smokers and non-smokers?

23.4392


d) Adjusting for the effects of alcohol consumption, is there a statistically meaningful relationship between life expectancy and smoking status? Provide the support for your conclusion.

Yes because the p-value is nearly 0.


e) How much of the variation in lifespan can be explained by smoking status and alcohol consumption.

71.29%

f) Which of the questions above are questions of statistical inference? 

\newpage
**Problem 2**
In an article published in Academic Press, Chester Bliss examined the impact of Vitamin C from two sources on the growth of teeth in Guinea pigs. In this experiment, the researchers measured the length of the teeth of the Guinea pigs as the experimental outcome and each Guinea pig was randomly assigned to one of two possible supplement treatments and one of three possible doses. (35 points)

The variables in the dataset are:

- length describes the length of growth in the teeth

- supp.VC indicates that the supplement type for Vitamin C is ascorbic acid (the baseline supplement type is OJ for orange juice)

- dose.2.0 indicates the amount of Vitamin C is 2.0 mg (the baseline is 1.0 mg.)


```{r echo=TRUE, eval=FALSE}
TGmod1.lm<-lm(len~supp+dose])
summary(TGmod1.lm)

## Call:
## lm(formula = len ~ supp + dose)

## Residuals:
##    Min     1Q Median     3Q    Max 
## -6.697 -2.765 -1.005  2.178  9.262 

## Coefficients:
##                     Estimate Std. Error t value   Pr(>|t|)    
## (Intercept)          21.197      1.061  19.976    < 2e-16 ***
## supp.VC              -2.925      1.225  -2.387     0.0222 *  
## dose.2.0              6.365      1.225   5.195   7.72e-06 ***
## ---
## Signif. codes:  0 Ô***Õ 0.001 Ô**Õ 0.01 Ô*Õ 0.05 Ô.Õ 0.1 Ô Õ 1

## Residual standard error: 3.875 on 37 degrees of freedom
## Multiple R-squared:  0.469,	Adjusted R-squared:  0.4403 
## F-statistic: 16.34 on 2 and 37 DF,  p-value: 8.202e-06
```

```{r echo=TRUE, eval=FALSE}
TGmod2.lm<-lm(len~supp*dose])
summary(TGmod2.lm)

## Call:
## lm(formula = len ~ supp * dose)

## Residuals:
##    Min     1Q Median     3Q    Max 
## -8.200 -2.337 -0.005  2.147  7.760 

## Coefficients:
##                         Estimate Std. Error   t value   Pr(>|t|)    
## (Intercept)               22.700      1.137    19.969    < 2e-16 ***
## supp.VC                   -5.930      1.608    -3.689    0.00074 ***
## dose.2.0                   3.360      1.608     2.090    0.04374 *  
## supp.VC:dose.2.0           6.010      2.274     2.643    0.01208 *  
## ---
## Signif. codes:  0 Ô***Õ 0.001 Ô**Õ 0.01 Ô*Õ 0.05 Ô.Õ 0.1 Ô Õ 1

## Residual standard error: 3.595 on 36 degrees of freedom
## Multiple R-squared:  0.5553,	Adjusted R-squared:  0.5183 
## F-statistic: 14.99 on 3 and 36 DF,  p-value: 1.717e-06
```


a) Write the 4 prediction equations in their most simplified form with actual numbers from the R output (round estimates to the nearest 100th) for the model WITHOUT interactions.


b) Write the 4 prediction equations in their most simplified form with actual numbers from the R output (round estimates to the nearest 100th) for the model WITH interactions.


c) Based on the R output, which model do you think is a better choice, the one WITH interactions or the one WITHOUT interactions? Why? (Be specific and cite evidence to back up your choice.)


d) Interpret the coefficient value in front of suppVC for the model you chose in part c. (Use words and describe it to someone who doesn't know statistics.)



\newpage
For **problems 3 and 4**, we are trying to understand how the aerial biomass (response variable) production of a certain type of marsh grass is related to the two predictor variables *pH*, which measures the pH level of the soil (from 0-14), and *K*, which measures the potassium level of the soil (in ppm). Aerial biomass is measured with units $gm^{-2}$. 


**Problem 3** 

Reference the R ouput and plots corresponding to Problem 3 at the end of this exam to answer this question. Consider the fit of a MLR regression model that includes the main effects of *pH* and *K* with the response and answe the following questions: (10 points) 

a) What is the average (absolute) difference in biomass (in $gm^{-2}$) for moss found in the "SI" location versus moss found in the "SM" location? 






b) What is the average (absolute) difference in biomass (in $gm^{-2}$) if the potassium (variable *K*) in the soil increases by 500 ppm? 






c) Based on this output, is it correct to say that the effect of changing pH level of the soil has a greater impact on the biomass than changing the potassium levels? Why or why not? 



\newpage
**Problem 4** Reference the R ouput and plots corresponding to Problem 4 at the end of this exam to answer this question. Suppose instead of looking at the relationship between biomass and the predictor variables, we decide to look at the relationship between the logarithm of the biomass and the predictor variables. Now fitting a linear regression model to this transformed response variable answer the following questions. As a reminder, the logarithmic function is defined by the relationship that if $y = log_{a}(x)$ then $a^{y}=x$ (and vice versa). (10 points)


a) Does this model look better or worse compared to the model in Problem 3? Justify your answer. 






b) What is the average difference in the response variable based on this linear regression model when  the potassium in the soil increases by 500 ppm? 







c) Are the answers to part(b) of Problem 4 and part (b) of Problem 3 directly comperable? Why or why not? 







\newpage 
**Problem 5** 

Below are three scatter plots for SLR models and three residual plots. Draw three lines connecting each scatterplot from the top row to the corresponding residual plot in the bottom row. (10 points)

```{r echo=FALSE}
set.seed(100)
x1 <- rnorm(400, 30, 5)
y1 <- x1 + rnorm(400, 0, 1)
y2 <- -(x1^2) + rnorm(400, 0, 10)
x1_ordered <- sort(x1)
y3 <- c(x1_ordered[1:150] + rnorm(150, 0, 1), x1_ordered[151:250] + rnorm(100, 0, 3), x1_ordered[251:400] + rnorm(150, 0, 5))

data_df <- data.frame(cbind(x1, y1, y2, y3))

fit1 <- lm(y1~x1)
fit2 <- lm(y2~x1)
fit3 <- lm(y3~x1)

sum1 <- summary(fit1)
sum2 <- summary(fit2)
sum3 <- summary(fit3)

s1 <- ggplot(data_df, aes(x=x1, y=y1)) +
      geom_point() + 
      labs(title="Scatterplot 1", x="X", y="Y")
s2 <- ggplot(data_df, aes(x=x1, y=y2)) +
      geom_point() + 
      labs(title="Scatterplot 2", x="X", y="Y")
s3 <- ggplot(data_df, aes(x=x1, y=y3)) +
      geom_point() + 
      labs(title="Scatterplot 3", x="X", y="Y")


p1 <- ggplot(data_df,aes(x=fit1$fitted.values, y=sum1$residuals)) +
  geom_point() + 
  geom_hline(yintercept=0) +
  labs(title="Residual plot", x="Predicted", y="Residuals")

p2 <- ggplot(data_df,aes(x=fit3$fitted.values, y=sum3$residuals)) +
  geom_point() + 
  geom_hline(yintercept=0) +
  labs(title="Residual plot",
       x="Predicted", y="Residuals")

p3 <- ggplot(data_df,aes(x=fit2$fitted.values, y=sum2$residuals)) +
  geom_point() + 
  geom_hline(yintercept=0) +
  labs(title="Residual plot",
       x="Predicted", y="Residuals")
```

```{r echo=FALSE}
library("gridExtra")
grid.arrange(s1,s2,s3,p1,p2,p3, nrow=2)
```

```{r, exam2resid, echo=FALSE, fig.align='center', out.width=500}
#knitr::include_graphics("Figs/resid_plot.png")
```








\newpage 
**R output for the model in Problem 3**

```{r}
biomass <- read_table2("~/Google Drive Swat/Swat docs/Stat 21/Data/biomass_data.txt", col_names = TRUE)

biomass %>% select(BIO, pH, K) %>% pairs(labels=c("biomass","pH","K"),pch=16) 

cor(biomass$pH, biomass$K)
as_factor(biomass$Location)
```


```{r}
MLR_bio <- lm(BIO ~ as_factor(Location) + pH + K , data = biomass)
MLR_bio_sum <- summary(MLR_bio)
MLR_bio_sum
```

```{r echo=FALSE, fig.align='center',out.width=600}
resid_data <- biomass %>% mutate(resid = MLR_bio_sum$residuals,
                                 yhat = MLR_bio$fitted.values)
ggplot(resid_data, aes(x=yhat, y=resid)) +
  #  geom_segment(aes(x=yhat, xend=yhat , y=rep(0, length(resid)), yend = resid)) + 
  geom_point() + 
  geom_hline(yintercept=0) +
  labs(title="Residual plot for biomass data", 
       x="Predicted biomass", y="Residuals")
```

```{r echo=FALSE, fig.align='center',out.width=600}
QQlarge <- ggplot(resid_data, aes(sample = yhat))
QQlarge + stat_qq() + stat_qq_line() + 
  labs(title = "Normal probability plot biomass data")
```


\newpage 

**R output for the model in Problem 4**

```{r echo=FALSE, fig.align='center',out.width=600}
biomass2 <- biomass %>% mutate(log_biomass = log(BIO))

MLR_bio_transformed <- lm(log_biomass ~ as_factor(Location) + pH + K , data = biomass2)
MLR_bio_transformed_sum <- summary(MLR_bio_transformed)
MLR_bio_transformed_sum
```

```{r echo=FALSE, fig.align='center',out.width=600}
resid_bio_transformed <- biomass2 %>% 
  mutate(resid = MLR_bio_transformed_sum$residuals,
         yhat = MLR_bio_transformed$fitted.values)

ggplot(resid_bio_transformed, aes(x=yhat, y=resid)) +
  #  geom_segment(aes(x=yhat, xend=yhat , y=rep(0, length(resid)), yend = resid)) + 
  geom_point() + 
  geom_hline(yintercept=0) +
  labs(title="Residual plot for biomass data", subtitle="Logarithmic transformation of the response variable",
       x="Logorithm of the predicted biomass", y="Residuals")
```

```{r echo=FALSE, fig.align='center',out.width=600}
QQlarge <- ggplot(resid_bio_transformed, aes(sample = yhat))
QQlarge + stat_qq() + stat_qq_line() + 
  labs(title = "Normal probability plot biomass data", subtitle = "Logarithmic transformation of the response variable")
```



