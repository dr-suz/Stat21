---
title: "Class 15"
subtitle: "Agenda for in-class discussion"
author: "STAT 021 with Suzanne Thornton"
institute: "Swarthmore College"
date: "For class on Tuesday, Oct 27, 2020 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
 #   css: ["default", "assets/sydney-fonts.css", "assets/sydney.css"]
    self_contained: false # if true, fonts will be stored locally
#    includes:
 #     in_header: "assets/mathjax-equation-numbers.html"
    nature:
#      beforeInit: ["assets/remark-zoom.js", "https://platform.twitter.com/widgets.js"]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9' # alternatives '16:9' or '4:3' or others e.g. 13:9
      navigation:
        scroll: false # disable slide transitions by scrolling
includes:
  in_header: mystyles.sty
---

```{r setup_pres, include=FALSE, echo=FALSE}
#devtools::install_github("ropenscilabs/icon")
#devtools::session_info('rmarkdown')

rm(list=ls())
library('tidyverse')
library('gridExtra')
library('broom')
library('cowplot')

library("RefManageR")
library("DT")

library('kableExtra')

#setwd("~/Google Drive Swat/Swat docs/Stat 21/Class13_files")
#setwd("~/Drive/Swat docs/Stat 21/Class9_files")
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.path='Figs/',echo=TRUE, warning=FALSE, message=FALSE)

```


```{css, echo=FALSE}
pre {
  background: #FFBB33;
  max-width: 100%;
  overflow-x: scroll;
}

.scroll-output {
  height: 70%;
  overflow-y: scroll;
}

.scroll-small {
  height: 30%;
  overflow-y: scroll;
}
   
.red{color: #ce151e;}
.green{color: #26b421;}
.blue{color: #426EF0;}
```

## Class 15, Tuesday the 27th

.scroll-output[Here's the agenda for today's class: 

- Housekeeping items

  - HW 5 - Due Thursday, Oct 29 by noon. 
  
  - Test 1 is almost graded. Example solutions of code is posted on Moodle. Detailed feedback for each question on Gradescope. 
  
  - Class 16 video will be available by this evening, comprehension quiz will be available by noon tomorrow. 
  
- Syllabus reminder: how much is each test worth? how much is participation worth?   
  
- Check-in   

- Moodle questions 
  
- Understanding random error 

- SLR Transforming SAT Data Wrap Up 

- Homework problems 

- Simulation experiment 
]

---
## Morning check in  
### 7 mins

.pull-left[**Instructions:**

- **Everyone**, use the "annotate" feature to put an "X" near the word(s) that most accurately describe how you are feeling this morning. 
- **Note-taker**, open this slide on your internet browser and share your screen with your group. 
- **Presenter**, take a screenshot of the page when everyone is finished marking their "X"'s and send it to me via your group's slack channel. I will verify that I have seen the image with a check mark on your Slack comment.
- **Recorder**, take notes on who is in attendance and who is performing each role for today's discussions.
- **Questioner**, make sure that everyone has a chance to check in and discuss how they are feeling today.]
.push-right[
```{r, echo=FALSE, fig.align='right', out.height=500}
knitr::include_graphics("Figs/real-feel.png")
```
]

---
## Moodle questions 
### Comprehension quiz for Class 15 

- What is extrapoloation? And how do you read the pairwise scatter plots for MLR? 

- Question 9: Suppose we have a model that predicts the price of a diamond ring as a linear function of the size of the diamond. Suppose for each of the rings in our sample we observe the price of the ring, the size of the diamond in the ring, and a numeric ranking of how pretty I think the ring is on a scale of 1-10. Which of the following is NOT possible? 

- Question 10:  Which of the following is NOT a valid conclusion from the R output below?

---
## Comparing SLR and MLR 

.scroll-output[
### Simple linear regression:
$$E[Y \mid x] = \hat{\beta}_0 + \hat{\beta}_1 x$$

T-test for significance of predictor
$$H_0: \beta_1 =0$$ 
F-test for the significance of regression
$$H_0: \beta_1=0$$

### Multiple linear regression: 
$$E[Y \mid x_1, \dots, x_p] = \hat{\beta}_0 + \hat{\beta}_1 x_1 + \hat{\beta}_2 x_2 + \cdots + \hat{\beta}_p x_p$$

T-test for determining if $\beta_1=0$ or if $\beta_2=0$ or $\beta_p=0$ etc. This is really a **partial** (or marginal) test because each regression coefficient depends on all of the other regressor variables included in the model. So an individual t-test is a test of the contribution  of predictor $x_j$  **given** the other regressors in the model. 
$$H_0: \beta_j = 0, \quad \text{for one of }j=1,2,\dots,p$$


F-test for determining the significance of regression
$$H_0: \beta_1 = \beta_2 = \cdots = \beta_p = 0$$
]


---
## Understanding the random error 
### Group work - 7 mins

.scroll-output[
For additional reading on understanding the role of the random variable corresponding to measurement error: Textbook Ch 1.1-1.3 

 
Let's consider a few previous examples and analyze the problem. What do we mean by "measurement error" in the following contexts? List a few different possible sources of error for each problem setting. 

- SAT data

- Diamond prices 

Keep in mind that in regression models, we assume there is **no** measurement error associated with the observations of our predictor variables. 


**Note-taker:** Take notes on your group discussion (either via Zoom whiteboard or by typing text into your group's slack chanel). Try to list as least three possible sources of noise for each of the problem settings above. 

**Presenter:** Be prepared to share your groups responses with the class. 

**Recorder:** Keep track of the time.  

**Questioner:** Be prepared to ask any questions that have come up within your group discussion when I stop by your breakout room. 
]



---
## Homework 5 Problems 
### Problem 1 

In a survey of $988$ men aged $18â€“24$, the regression equation for predicting height from weight was: 
$$height = 62.4 + (0.047)(weight),$$
where height is measured in inches and weight is measured in lbs. 

(b) Suppose the variance of our model errors is $\sigma^2=2$. What percentage of all $200$-pound men are taller than $74$ inches? (Assume the regression model assumptions are met.)

.scroll-small[
### Group Discussion - 7 mins

Discuss how to solve the question above. Come up with a plan to find the answer. You do not need to find the answer, just show me that you've discussed a strategy for solving it. 

**Note-taker:** Take notes on your group discussion (either via Zoom whiteboard or by typing text into your group's slack chanel). Try to list as least three possible sources of noise for each of the problem settings above. 

**Presenter:** Be prepared to share your groups responses with the class. 

**Recorder:** Keep track of the time.  

**Questioner:** Be prepared to ask any questions that have come up within your group discussion when I stop by your breakout room. 
]

---
## Homework 5 Problems 
### Problem 9 (group discussion 7 mins)

Note that there is a categorical variable called "purpose" included in the data set. Suppose we are interested in determining if there is a significant difference in the average height of a building depending on its purpose. Using `height` (in meters) as the response and purpose as the explanatory variable, fit an ANOVA model to this data after excluding the data point for the only hospital (see code below). What does the result of the ANOVA F-test indicate? 

```{r}
skyscrapers <- read_csv(url("http://www.swarthmore.edu/NatSci/sthornt1/DataFiles/skyscraper_data.csv"))
skyscrapers_edit <- skyscrapers %>% filter(!(purpose=="hospital"))
```


.scroll-small[
### Group Discussion - 7 mins

Q1: What is the ANOVA F-test testing? (What's the null and alternative?)

Q2: Consider two different modeling approaches: 1) fit many individual SLR models where the number of floors predicts the height, for each different building type or 2) fit a MLR model where both number of floors and building type are the predictos and height is the response. Why might we want  to use one method over the other? 

**Note-taker:** Take notes on your group discussion (either via Zoom whiteboard or by typing text into your group's slack chanel). Try to list as least three possible sources of noise for each of the problem settings above. 

**Presenter:** Be prepared to share your groups responses with the class. 

**Recorder:** Keep track of the time.  

**Questioner:** Be prepared to ask any questions that have come up within your group discussion when I stop by your breakout room. 
]

---
## SLR - Transforming data 
### Group work  

Complete Step 3 of the [worksheet](https://docs.google.com/document/d/1BO_59xZriB8RJS43B6kOCMfHn3cOgn_lA5uBmuqg6os/edit?usp=sharing) from last class. As before, you may find it useful to review some properties of logarithms and exponents using this [reference](https://wou.edu/mathcenter/files/2015/09/Exponents-and-Logarithms.pdf). 

**Note-taker:** You will submit the completed worksheet to me over your group's Slack channel at the end of class. (Please make sure the settings allow me to access your document!) 

**Presenter:** Be prepared to answer questions based on your worksheet when we discuss the worksheet as a class. 

**Recorder:** Keep track of the time and alert your group when you have 5 mins remaining. 

**Questioner:** Be prepared to ask any questions that have come up within your group discussion when I stop by your breakout room. 



---
## SLR - Transforming data 
### Group work  

We are going to practice transforming the data to fit a stronger linear model to the SAT score data from Problem 3 of Test 1. 

**Step 1**

1. Use the code on the next two slides to write out the estimated regression equation for the data and interpret the meaning of the slope. 
2. What important features do you notice in the scatter plot of the data, the residual plot, and/or the normal probability plot for the standardized residuals?

```{r eval=FALSE}
income_SAT2 <- tibble(income = c(10000, 30000, 50000, 70000, 90000, 110000,
                                 130000, 150000, 180000, 300000),
                      SAT_score = c(1323, 1398, 1461, 1503, 1545, 1580, 1594,
                                     1619, 1636, 1721))
SLR_SAT <- lm(SAT_score ~ income, income_SAT2)
summary(SLR_SAT)
```


---
## SLR - Transforming data 
### Step 1 continued


```{r eval=FALSE}
ggplot(income_SAT2, aes(x=income ,y=SAT_score)) +
  geom_point() + 
  labs(title="SAT data scatter plot", x="Household income", y="SAT Score")

income_SAT2 <- income_SAT2 %>% mutate(resids = SLR_SAT$residuals,
                                      fits = SLR_SAT$fitted.values)
ggplot(income_SAT2, aes(sample=SAT_score)) +
  stat_qq() + 
  stat_qq_line() + 
  labs(title="Normal prob plot for residuals")

ggplot(income_SAT2, aes(x=fits, y=resids)) +
  geom_point() + 
  labs(title="Residuals vs fitted values", x="Fitted values", y="Residuals") +
  geom_hline(yintercept=0)
```



---
## SLR - Transforming data 
### Group work  

**Step 2**

1. Use the `mutate` function to transform the response variable $Y$ by raising `SAT_score` to the 10th power. I.e. create a new response variable $Y_{transformed} = Y^{10}$. Then fit a SLR model using $x$ to predict $Y_{transformed}$.  
2. Produce and interpret a scatter plot of the data, a residual plot, and a normal probability plot for the residuals.
3. Write out the estimated regression equation for the transformed data and then interpret the slope of this model and in the context of the original units of $Y$. 


```{r eval=FALSE}
# Here is how to find a logarithm of base 10 in R
a <- 22000
b <- log(a, base=10)
10^b  # Double check the properties of logarithms 
```


---
## SLR - Transforming data 
### Group work - 15 mins  

**Step 3** (Reference the Class 14 Part 3 lecture notes for the code.) 

1. Use the regression model from Step 2 to compute a confidence interval for the mean SAT score for a student from a household making $62,000 per year. Interpret this interval in the units of the un-transformed data.   
2. Use the regression model from Step 2 to compute a prediction interval for the SAT score of a student from a household making $120,000 per year. Interpret this interval in the units of the un-transformed data.   


```{r echo=FALSE, eval=FALSE}
**Step 3**

1. Use the `mutate` function to transform the predictor variable `income` by taking the logarithm. I.e. create a new predictor variable $x_{transformed} = log(x)$. Then fit a SLR model using $x_{transformed}$ to predict $Y$.   
2. Produce and interpret a scatter plot of the data, a residual plot, and a normal probability plot for the standardized residuals.
3. Write out the estimated regression equation for the transformed data and  interpret the slope. 


For future classes/comprehension quizzes: In each of the following situations, determine which is more appropriate: a confidence interval for the mean response or a prediction interval for an unobserved response. 
```


---
## Simulation Study
### Problem 2.23 in textbook

Consider the simple linear regression model 
$$y = 50 + 10x + \epsilon, \quad \text{where } \epsilon \sim N(0,16).$$
Generate 500 samples of 20 observations drawing one observation for each level of $x=1,1.5,, \dots,10$ for each sample. 

(a) For each sample compute the least-squares estimates of the slope and intercept. Construct histograms of the sample values of $\hat{\beta}_0$ and $\hat{\beta}_1$. Discuss the shape of these histograms. 

(b) For each sample, compute an estimate of $E[Y \mid x=5]$. Construct a histogram of the estimates you obtained. Discuss the shape of the histogram 

(c) For each sample, compute a $95\%$ CI on the slope. How many of these intervals contain the true value $\beta_1=10$? Is this what you would expect?

(d) For each estimate of $E[Y \mid x=5]$ in part (b), compute the $95\%$ CI. How many of these intervals contain the true value of $E[Y \mid x=5]=100$? Is this what you would expect? 
