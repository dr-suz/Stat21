<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Class 9 - Part 1</title>
    <meta charset="utf-8" />
    <meta name="author" content="STAT 021 with Suzanne Thornton" />
    <link href="class9-part1_files/remark-css/default.css" rel="stylesheet" />
    <link href="class9-part1_files/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Class 9 - Part 1
## Analysis of Variance (ANOVA)
### STAT 021 with Suzanne Thornton
### Swarthmore College
### For class on Tuesday, Oct 6, 2020 (updated: 2020-10-02)

---




&lt;style type="text/css"&gt;
pre {
  background: #FFBB33;
  max-width: 100%;
  overflow-x: scroll;
}

.scroll-output {
  height: 70%;
  overflow-y: scroll;
}

.scroll-small {
  height: 50%;
  overflow-y: scroll;
}
   
.red{color: #ce151e;}
.green{color: #26b421;}
.blue{color: #426EF0;}
&lt;/style&gt;


## ANOVA notation


| Categorical varb | `\(n\)` | Sample mean | Populaton mean | Sample variance | Population variance | 
|-----------------|-----|------|-------|----|---|----|
| Level 1 | `\(n_1\)` | `\(\bar{y}_{1}\)` | `\(\mu_{1}\)` | `\(s_{1}^{2}\)` | `\(\sigma_{1}^{2}\)` |
| Level 2 | `\(n_2\)` | `\(\bar{y}_{2}\)` | `\(\mu_{2}\)` | `\(s_{2}^{2}\)` | `\(\sigma_{2}^{2}\)` |
| `\(\vdots\)` |  |   |   |    |   |   |
| Level K | `\(n_K\)` | `\(\bar{y}_{K}\)` | `\(\mu_{K}\)` | `\(s_{K}^{2}\)` | `\(\sigma_{K}^{2}\)` |

Note that we assume `\(\sigma_{1}^{2} = \sigma_{2}^{2} = \cdots = \sigma_{K}^2 = \sigma^2\)`! 


---
## ANOVA notation

The hypotheses for an ANOVA test are

`$$H_0: \mu_1 = \mu_2 = \dots = \mu_k \\ H_1: \text{ Not all }\mu_i \text{ are equal, for }i=1,\dots,k$$`


You can think of an ANOVA model as a generalization of the t-test for the difference in means. With ANOVA, we can test if **more than two** group means are the same. 


--
**Q:** Why not do a bunch of t-tests instead of one ANOVA test? 


---
## Answer to question


If all our tests were independent, (this is not likely to be the case but it's the "best" of the worst case scenarios) then as the number of tests increases, so does our chance of randomly incorrectly rejecting the null hypothesis. 


`$$Pr( \text{making a type I error}) = \alpha \\
Pr(\text{not making a type I error}) = 1- \alpha$$`

`$$Pr(\text{not making a type I error in m independent hypothesis tests}) = (1-\alpha)^m\\
Pr(\text{making at least one type I error our of m tests}) = 1 - (1-\alpha)^m$$`

---
## Answer to question



```r
1 - (1 - 0.05)      ## a single test
```

```
## [1] 0.05
```

```r
1 - (1 - 0.05)^3    ## three tests
```

```
## [1] 0.142625
```

```r
1 - (1 - 0.05)^10   ## 10 tests
```

```
## [1] 0.4012631
```

.footnote[For more on the problem of multiple testing go &lt;a href="https://www.stat.berkeley.edu/~mgoldman/Section0402.pdf"&gt;here&lt;/a&gt;.

For an alternative (Bayesian) approach to avoid dealing with multiple testing problem see &lt;a href="http://www.stat.columbia.edu/~gelman/research/published/multiple2f.pdf"&gt;this&lt;/a&gt; paper. NOT on future test, just FYI]

---
## One-way ANOVA 

`$$Y_{i,j}  = \mu_{i} + \epsilon_{i,j}$$` 

Here `\(i = 1,\dots, k\)` and `\(j = 1, \dots, n_{i}\)`.


Assumptions (regarding the random error in our continuous, quantitative response):

1. Homogeneity of variance (i.e. `\(Var(\epsilon)=\sigma^2\)`)

1. Each `\(\epsilon\)` is independent of any other random error. 

1. The random errors, `\(\epsilon\)` are Normally distributed. (Only necessary for inference.)



--
- Violations of the homogeneity of variance assumption are most problematic if the ANOVA is unbalanced (i.e. if the category sample sizes `\(n_1, \dots, n_k\)` differ) or if there are systematic patterns to the changes in spread. 


 - A helpful rule of thumb is to aim to have at least a dozen or so observations within each category (otherwise the homogeneity of variance is a difficult assumption to verify). 


---
## ANOVA F-test 
### Calculations by hand

R will automatically create the following ANOVA table for you. 

| Source | Sums of Squares | DF | Mean Square | F-ratio | P-value | 
|--------|------------------|---|-------------|---------|---------|
| Treatment | `\(SS_{trt}= \sum \sum(\bar{y}_{j}-\bar{\bar{y}})^2\)` | `\(K-1\)` | `\(MS_{trt} = \frac{SS_{trt}}{K-1}\)` | `\(\frac{MS_{trt}}{MSE}\)` | `\(Pr(F \geq \frac{MS_{trt}}{MSE})\)` | 
| Error | `\(SSE=\sum\sum(y_{ij}-\bar{y}_{j})^2\)` | `\(n-K\)` | `\(MSE = \frac{SSE}{n-K}\)` |   |  | 
| Total | `\(SS_{tot}=SS_{trt}+SSE\)`  | `\(n-1\)` |   |   |   |


This test is called an ANOVA F-test. Behind the scenes, R calculates

`$$\text{Test Statistic} = F-statistic = \frac{MS_{trt}}{MSE},$$`
and then computes the p-value. 

The **p-value** is the probability that a F-distributed RV with numerator degrees of freedom `\(K-1\)` and denominator degrees of freedom `\(n-K\)` takes on the observed F-ratio or a larger number. 

---
## Additional resources

Here are some links to some additional resources for understanding ANOVA models. 

&lt;a href="http://www.biostathandbook.com/onewayanova.html"&gt;Here&lt;/a&gt; is a helpful free resource summarizing ANOVA (and other general statistical) methods.

&lt;a href="https://statisticsbyjim.com/anova/f-tests-anova/"&gt;Here&lt;/a&gt; is a link to a summary on what is an F-test in an ANOVA model.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
