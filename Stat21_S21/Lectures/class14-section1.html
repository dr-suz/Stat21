<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Class 14 - Section 1</title>
    <meta charset="utf-8" />
    <meta name="author" content="Suzanne Thornton" />
    <script src="class14-section1_files/header-attrs/header-attrs.js"></script>
    <link href="class14-section1_files/remark-css/default.css" rel="stylesheet" />
    <link href="class14-section1_files/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Class 14 - Section 1
## Statistical Methods II (Stat 021)
### Suzanne Thornton
### Swarthmore College
### For class on Thursday, April 1, 2021 (updated: 2021-04-01)

---




&lt;style type="text/css"&gt;
pre {
  background: #FFBB33;
  max-width: 100%;
  overflow-x: scroll;
}

.scroll-output {
  height: 60%;
  overflow-y: scroll;
}

.scroll-small {
  height: 30%;
  overflow-y: scroll;
}
   
.red{color: #ce151e;}
.green{color: #26b421;}
.blue{color: #426EF0;}
&lt;/style&gt;

## Group work  
### Part I - Building and interpreting a SLR model 

(Homework 5: Problems 5-10)

The following data set was collected in 2018-2019 and recorded different attributes of skyscrapers in NYC. We are going to investigate how the height (in meters) `\((Y)\)` of a skyscraper depends on the number of stories (i.e. floors) it has `\((x)\)`. 


```r
skyscrapers &lt;- read_csv(
                url("http://www.swarthmore.edu/NatSci/sthornt1/DataFiles/skyscraper_data.csv"))
head(skyscrapers)
```

```
## # A tibble: 6 x 8
##      ID Building_name    height_meters height_ft floors  year material  purpose 
##   &lt;dbl&gt; &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;   
## 1     1 30 Hudson Yards           387.      1268     73  2019 concrete… office  
## 2     2 3 World Trade C…          329.      1079     69  2018 composite office  
## 3     3 35 Hudson Yards           308.      1010     71  2019 concrete  residen…
## 4     4 220 Central Par…          290.       952     70  2019 concrete  residen…
## 5     5 15 Hudson Yards           279.       914     70  2019 concrete  residen…
## 6     6 The Centrale              245.       803     64  2019 concrete  residen…
```


---
## Group work  
### Part I - Building and interpreting a SLR model 

.scroll-output[
The following code creates a SLR model for this problem and names the model `SLR_sky`.

```r
SLR_sky &lt;- lm(height_meters ~ floors, skyscrapers)
SLR_sky
```

```
## 
## Call:
## lm(formula = height_meters ~ floors, data = skyscrapers)
## 
## Coefficients:
## (Intercept)       floors  
##     -19.488        4.308
```

This model contains a lot of different information that is not obvious from the output above:

```r
names(SLR_sky)
```

```
##  [1] "coefficients"  "residuals"     "effects"       "rank"         
##  [5] "fitted.values" "assign"        "qr"            "df.residual"  
##  [9] "xlevels"       "call"          "terms"         "model"
```


With your group, interpret the output of `summary(SLR_sky)`. Answer the following questions and submit your responses to me on Slack. 

**Question 1:** 

  (a) Write and interpret the estimated regression equation.

  (b) Find a `\(95\%\)` CI for the estimated effect of the number of floors on the height of the building. (Hint: Use the function `confint(SLR_sky, 'floors', level=0.95)`)

  (c) Identify the estimate of the variance of the random error. 

**Question 2:** 

Which assumptions are required to answer each of the questions above? 

**Question 3:** 

How can you evaluate the independence assumption? 
]

---
## Group work
### Part I - Solutions 

.scroll-output[
**Question 1:** 

  (a) Write and interpret the estimated regression equation.
  
.blue[The estimated regression equation is:] `\(\hat{y} =E(Y \mid x) = -19.49 + 4.32x\)`.blue[, where ] `\(x=\text{the number of floors}\)` and `\(y=\text{the height in meters}\)`.blue[. The intercept is not necessarily directly interpretable although one possible way to interpret it in this case is perhaps this is the height of the ground floor or basement of a building. The slope on the other hand is directly interpretable. The slope tells us that for each additional floor a building has, we expect the **average height** of the building overall to increase by `\(4.3\)` meters. The word average is crucial here!]

  (b) Find a `\(95%\)` CI for the estimated effect of the number of floors on the height of the building. (Hint: Use the function `confint(SLR_sky, 'floors', level=0.95)`)
  
.blue[The code above produces a `\(95%\)` confidence interval from `\(3.82\)` to `\(4.80\)`. That is, we are `\(95%\)` confidence that the true value of] `\(\beta_1\)` .blue[-the true average change in height of the building for each additional floor - is between `\(3.82\)` meters and `\(4.3\)` meters.]

  (c) Identify the estimate of the variance of the random error. 
  
.blue[The summary of the regression model displays the *residual standard error*, or] `\(\hat{\sigma}=25.8\)`.blue[. Therefore the estimated variance of the random error is] `\(\hat{\sigma}^2 = 25.8^2\)`.
]

---
## Group work
### Part I - Solutions 



**Question 2:** 

Which assumptions are required to answer each of the questions above? 

.blue[Part (a) and (c) of Question 1 are estimation questions for which we only need to assume the errors have zero mean, constant variance/spread (we'll talk more about how to check this later), and are independent. Part (b) however is a question of inference and so we must also check the assumption that the errors are Normally distributed.]

**Question 3:** 

How can you evaluate the independence assumption? 

.blue[Our random error in this model is anything that is keeping the number of floors a building has from being an exact predictor of the height of the building overall. Perhaps ]


---
## Group work  
### Part II - Interpreting plots for SLR models  

(Homework 5: Problems 5-10)
.scroll-output[

The following code creates a scatter plot of the data and fits the linear regression line over it (as well as a confidence bound on the regression line). 

```r
ggplot(skyscrapers, aes(x=floors ,y=height_meters)) +
  geom_point() + 
  geom_smooth(method='lm') + 
  labs(title="Skyscraper Data", x="Number of floors", y="Height (in m)")
```

![](Figs/unnamed-chunk-5-1.png)&lt;!-- --&gt;
]

---
## Group work  
### Part II - Interpreting plots for SLR models  

.scroll-output[
You can extract the residuals and fitted values from your model with the following code: 

```r
SLR_sky$residuals 
SLR_sky$fitted.values
```

Recall you can use the `mutate()` function to add new columns to an existing data object (tibble). 

**Question 1:**

What is the correlation between the variables `floors` and `height_meters`? (Hint: Use the `cor()` function in R.)

**Question 2:**

What is the coefficient of determination? 

**Question 3:**

Use the following code to create a residual plot of the residuals vs the fitted values and interpret. 


```r
ggplot(?, aes(x=?, y=?)) +
  geom_point() + 
  labs(title="Residuals vs fitted values", x="Fitted values", y="Residuals") +
  geom_hline(yintercept=0)
```

**Question 4:**

Use the following code to create a normal probability plot of the standardized residuals and interpret. 


```r
ggplot(?, aes(sample=?)) +
  stat_qq() + 
  stat_qq_line() + 
  labs(title="Normal prob plot for the standardized residuals")
```
]

---
## Group work  
### Part II - Solutions

.scroll-output[
You can extract the residuals and fitted values from your model with the following code: 

```r
SLR_sky$residuals 
SLR_sky$fitted.values
```

Recall you can use the `mutate()` function to add new columns to an existing data object (tibble). 

**Question 1:**

What is the correlation between the variables `floors` and `height_meters`? (Hint: Use the `cor()` function in R.)

.blue[Using the R code `cor(skyscrapers$floors, skyscrapers$height_meters)` we find a correlation of 0.94.]

**Question 2:**

What is the coefficient of determination? 

.blue[The coefficient of determination, or R-squared value, is found in the model summary. We are going to use the adjusted R-squared value (more on why later) which is 0.87.]

]

---
## Group work  
### Part II - Solutions

.scroll-output[
To create these plots, it's useful to create a second data object that contains the standardized residuals and the fitted values:

```r
skyscrapers2 &lt;- skyscrapers %&gt;% mutate(residuals_std = scale(SLR_sky$residuals),
                                       fitted_vals = SLR_sky$fitted.values)
```

**Question 3:**

Use the following code to create a residual plot of the residuals vs the fitted values and interpret. 


```r
ggplot(skyscrapers2, aes(x=fitted_vals, y=residuals_std)) +
  geom_point() + 
  labs(title="Residuals vs fitted values", x="Fitted values", y="Residuals") +
  geom_hline(yintercept=0)
```

.blue[Interpretation: We're looking for evidence of a non-constant spread in the residuals, i.e. some type of funneling behavior. We do see some pretty strong evidence of a change in the dispersion of the residuals in this plot. Notice how at the fitted y-values of 50 or 100 or 150 the spread of the residuals is about 1 or two units but when we get to larger fitted values (around 280 and 300), the residuals are spread out by about 3 units. This shows that as the fitted values increase - or for larger predicted heights - there is more variability in the discrepancy between the actual building height and the predicted height.]

]

---
## Group work  
### Part II - Solutions

**Question 4:**

Use the following code to create a normal probability plot of the standardized residuals and interpret. 


```r
ggplot(skyscrapers2, aes(sample=residuals_std)) +
  stat_qq() + 
  stat_qq_line() + 
  labs(title="Normal prob plot for the standardized residuals")
```

.blue[Interpretation: We're checking the assumption that the errors are normally distributed by determining if the residuals look Normally distributed. There is some strong deviation from the diagonal line that indicates a Normal distribution, especially for larger values of our standardized residuals. We see some indication here that the largest values of our residuals are even bigger than we would expect if the random error was actually Normally distributed. Thus we have slightly higher upper tail values than we would under Normality.]


---
### Planning ahead for next week  

- Watch the videos for Week 9 before Tuesday's class.  

  * Confidence intervals, prediction intervals for SLR
  
  * Analysis of variance for SLR 
  
  * Transforming data for regression models 
  
  * Introduce multiple linear regression (MLR)

- Finish and submit HW 5 before Monday, April 5th at 8am EST. 

  * .blue[You can skip Problem 8]

  * Remember to select which pages contain solutions for each problem! 

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
