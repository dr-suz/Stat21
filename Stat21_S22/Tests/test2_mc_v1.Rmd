---
title: "Test 2 - part 1"
subtitle: "STAT 021"
author: "Swarthmore College"
output:  
  pdf_document:
    latex_engine: xelatex
fontsize: 12pt
geometry: margin=1in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message=F, warning=F)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(kableExtra)
library(knitr)
library(tidyverse)
library(png)
library('broom')
library('cowplot')

#setwd("~/Google Drive Swat/Swat docs/Stat 21/Data")
options(htmltools.dir.version = FALSE)
#options(knitr.kable.NA = '')

#vg_data <- read_csv("~/Google Drive/Swat docs/Stat11_S20/Midterm1/vgsalesGlobale.csv")
#vg_subset <- vg_data %>% filter((Publisher=="Nintendo")|
#                                (Publisher=="Namco Bandai Games")|(Publisher=="Electronic Arts")) %>% 
#                         filter(Global_Sales <= 4)
theme_set(theme_bw())
```

```{css, echo=FALSE}
pre {
  background: #FFBB33;
  max-width: 100%;
  overflow-x: scroll;
}
```

\hspace{1in} **Do not flip this page until instructed to do so.** 

\vspace{.2in}

**Test organization:** There are $X$ questions in total on this test and they are organized into two subsections: the first **X** questions are select all that apply multiple choice questions and the last **X** questions are free response. If you need additional paper you may come to the front of the class and pick some up. There are a total of $XX$ points possible on this test. 

**Instructions:** The first part of this test are multiple choice questions that do not require any additional explanation or work. No extra work will be considered in the grading of these questions but *you can get partial credit* for many of these questions.  The last part of this test involves short answer questions. For these questions, you must show all your work and/or provide enough justification and explain your reasoning in order to get full credit or be considered for partial credit. You do not need a calculator to evaluate any expressions. For any calculation problems, simply writing out the formula to find the answer will suffice. 


\vspace{.2in}

**First and Last Name:** _____________________________

\vspace{.2in}

**Swarthmore Username:** ______________________________

\vspace{0.5cm}


**Take a deep breath.** 

You have prepared for this test and with a clear and well-rested mind, you are ready to show me what you have learned this semester. As with the other tests, the purpose of this test is to measure your understanding of the material we have covered. This is nothing more than a metric for me to evaluate your preparedness to think statistically at this particular moment in time and in this particular setting. This is not a perfect measure of your knowledge and does not predict your future statistical skills. 



```{r echo=FALSE}
mobility <- read_csv("mobility.csv")

## To do: think of another way to categorize states, red/blue/purple ? (year is 1980-1982)
Confederacy = c("AR","AL","FL","GA","LA","MS","NC","SC","TN","TX","VA")
mobility$Dixie = mobility$State %in% Confederacy %>% factor
mobility$...1 = mobility$ID
mobility0 <- mobility %>% select(-c("Latitude", "Longitude"))
#mobility %>% head
```

\pagebreak

## Multiple choice problems (2 points each)

Suppose we are trying to understand how the aerial biomass (response variable) production of a certain type of marsh grass is related to the three predictor variables 

- *pH*, which measures the pH level of the soil (from 0-14), 

- *K*, which measures the potassium level of the soil (in ppm), and 

- the categorical variable *location* which can be one of three different spots ("OI" is short for Oak Island, "SI" is short for Smith Island, and "SM" is short for Snows Marsh). 

Aerial biomass is called `BIO` and is measured with units $gm^{-2}$. 


```{r echo=FALSE}
biomass <- read_table2("biomass_data.txt", col_names = TRUE) 
biomass$Location <- biomass$Location %>% as.factor
```

Consider the main effects model shown below. The summary output is shown on the next page. Below the model summary is a plot of the studentized residuals and leverage values for each data point based on this model. The heavy dashed lines represent "extreme" cutoffs and the short dashed lines represent "moderate" cutoffs for leverage (blue), studentized residuals (green), and Cook's distance (purple), respectively. 

Use this information to answer questions 1-4.


$$\hat{biomass} = \hat{\beta}_0 + \hat{\beta}_1 pH + \hat{\beta}_2 K + \hat{\beta}_3 LocationSI + \hat{\beta}_4 LocationSM + \epsilon, \text{ where}$$
$LocationSI = \begin{cases} 1, \text{ if at Smith Island} \\ 0, \text{ otherwise} \end{cases} \text{ and } LocationSM = \begin{cases} 1, \text{ if at Snows Marsh} \\ 0, \text{ otherwise} \end{cases}$

\pagebreak 


```{r echo=FALSE}
MLR_bio <- lm(BIO ~ pH + K + Location, data = biomass)
summary(MLR_bio)
```

```{r echo=FALSE}
#mobility %>% head
set.seed(101)
rsamp <- sample(1:length(mobility0$State), 70, replace=FALSE)
mobility <- mobility0[rsamp,] 
mobility[65,2] <- .4  ## to create extreme Cook's D (fake data)
n<-length(mobility$State)
k <- 3
mod_mobility <- lm(Mobility ~ Commute + Dixie + Commute*Dixie, data=mobility)

influential_pts_data <- mobility %>% mutate(studresids = rstudent(mod_mobility),
                                            leverage = hatvalues(mod_mobility),
                                            cooksd = cooks.distance(mod_mobility),
                                            e_as_h1 = abs(sqrt(((1/leverage)-1)*(0.5*(k+1)))),
                                            e_as_h2 = abs(sqrt(((1/leverage)-1)*(1*(k+1)))))
                                            # fits = mod_mobility$fitted.values,
## plot lines where cooksd = 0.5 and 1 
## d = (stures^2/(k+1))*(h/(1-h))
## plot lines where studresids = 2 and 3 
## plot lines where leverage = 2k/n and 3k/n 


ggplot(data=influential_pts_data) + 
  geom_point(aes(x=leverage, y=studresids),size=1.5) + ylim(-12,12) +
     geom_text(aes(x=leverage, y=studresids), label=rownames(influential_pts_data), nudge_y = -.7) +
  geom_hline(yintercept=2, col="green", lty=3, size=1)+geom_hline(yintercept=-2, col="green", lty=3, size=1) +
  geom_hline(yintercept=3, col="green", lty=2, size=1)+geom_hline(yintercept=-3, col="green", lty=2, size=1) +
  geom_vline(xintercept=2*k/n, col="blue", lty=3, size=1)+geom_vline(xintercept=3*k/n, col="blue", lty=2, size=1) +
  geom_smooth(aes(x=leverage, y=e_as_h1), lty=3, col="purple", se=FALSE)+
    geom_smooth(aes(x=leverage, y=-e_as_h1), lty=3, col="purple", se=FALSE) + 
  geom_smooth(aes(x=leverage, y=e_as_h2), lty=2, col="purple", se=FALSE)+
    geom_smooth(aes(x=leverage, y=-e_as_h2), lty=2, col="purple", se=FALSE) 
```


\pagebreak 


## Problem 1

Which of the following statements are supported by the R output for this model? (Circle all that apply)

(a) The effect of changing pH level of the soil has a greater impact on the biomass than changing the potassium level. 

(b) The effect of changing the potassium level of the soil has a greater impact on the biomass than changing the pH level. 

(c) The effect of changing the pH level of the soil on the biomass depends on the potassium level of the soil. 

(d) Comparing grass from soil with match pH levels and potassium levels, grass from the Snows Marsh tends to have higher biomass than grass from Oak Island. 



## Problem 2

Which of the following represents the reduced model if we want to determine whether or not to include the categorical predictor for location? (Circle all that apply)

(a) $\hat{biomass} = \hat{\beta}_0 + \hat{\beta}_1 pH + \hat{\beta}_2 K + \hat{\beta}_3 LocationSI + \hat{\beta}_4 LocationSM + \epsilon$

(b) $\hat{biomass} = \hat{\beta}_0 + \hat{\beta}_3 LocationSI + \hat{\beta}_4 LocationSM + \epsilon$

(c) $\hat{biomass} = \hat{\beta}_0 + \hat{\beta}_1 pH + \hat{\beta}_2 K + \epsilon$

(d) $\hat{biomass} = \hat{\beta}_0 + \hat{\beta}_1 pH + \hat{\beta}_2 K + \hat{\beta}_3 LocationSI + \epsilon$


## Problem 3 

Which of the following data points are likely most unusual with respect to soil pH and potassium level (K)? (Circle all that apply)

(a) Observation 66

(b) Observation 65 

(c) Observation 9

(d) Observation 53




## Problem 4 

Which of the following data points are likely most unusual with respect to their observed biomass? (Circle all that apply)

(a) Observation 66

(b) Observation 65 

(c) Observation 9

(d) Observation 53


