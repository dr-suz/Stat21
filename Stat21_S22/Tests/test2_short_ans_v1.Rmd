---
title: "Test 2 - part 2"
subtitle: "STAT 021"
author: "Swarthmore College"
output:  
  pdf_document:
    latex_engine: xelatex
fontsize: 12pt
geometry: margin=1in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message=F, warning=F)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(kableExtra)
library(knitr)
library(tidyverse)
library(png)
library('broom')
library('cowplot')

#setwd("~/Google Drive Swat/Swat docs/Stat 21/Data")
options(htmltools.dir.version = FALSE)
#options(knitr.kable.NA = '')

#vg_data <- read_csv("~/Google Drive/Swat docs/Stat11_S20/Midterm1/vgsalesGlobale.csv")
#vg_subset <- vg_data %>% filter((Publisher=="Nintendo")|
#                                (Publisher=="Namco Bandai Games")|(Publisher=="Electronic Arts")) %>% 
#                         filter(Global_Sales <= 4)
theme_set(theme_bw())
```

```{css, echo=FALSE}
pre {
  background: #FFBB33;
  max-width: 100%;
  overflow-x: scroll;
}
```


# Short answer questions 

## Problem 5


The R-output below contains the results from a regression model fit to a data set concerning life expectancy in years, alcohol consumption in drinks per day, and smoking status (smoker - Yes vs. non-smoker - No). Answer the following questions pertaining to the R output below. 


```{r echo=TRUE, eval=FALSE}
## Call:
## lm(formula = Lifespan ~ Alcohol + Smoker)
 
## Residuals:
## Min 1Q Median 3Q Max
## -30.796 -7.139 0.125 6.949 19.578
 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)
## (Intercept) 93.6818  2.1024     44.56   <2e-16 ***
## Alcohol     -3.2656  0.3147    -10.38   <2e-16 ***
## SmokerYes  -23.4392  1.9922    -11.77   <2e-16 ***
## ---
## Signif. codes: 0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
## Residual standard error: 9.959 on 97 degrees of freedom
## Multiple R-squared: 0.7129, Adjusted R-squared: 0.7069
## F-statistic: 120.4 on 2 and 97 DF, p-value: < 2.2e-16
``` 
 

a) How does drinking alcohol affect average life expectancy? (2 points)

b) Suppose someone consumes about 2.5 alcoholic drinks per day and smokes regularly. Calculate (provide the formula for) the average life expectancy for this individual. (1 point)

c) What is the average difference in lifespan between smokers and non-smokers? (1 point)

d) Supposing we fix the amount of alcohol consumption; is there a statistically significant relationship between life expectancy and smoking status? Justify your answer. (2 points)



\newpage

For Problem 6 and 7 we are going to examine the impact of Vitamin C from two different sources and at two different dosages on the growth of teeth in a random sample of Guinea pigs. The variables in the data set are:

- *len* - a numeric variable representing the length of growth in the teeth (in cm)

- *supp.VC* - a binary categorical variable that is 1 if the Vitamin C supplement type is ascorbic acid and is 0 if the Vitamin C supplement type is orange juice. 

- *dose.2.0* - is a binary categorical variable that is 1 if the amount of Vitamin C is 2.0 mg and is 0 if the amount of Vitamin C is 1.0 mg.


## Problem 6

```{r echo=FALSE}
# For next year, find or create a new data set for MLR with an interaction term 
data("ToothGrowth")
```


```{r echo=TRUE, eval=FALSE}
teeth_SLR_main<-lm(len ~ supp + dose)
summary(teeth_SLR_main)

## Call:
## lm(formula = len ~ supp + dose)

## Residuals:
##    Min     1Q Median     3Q    Max 
## -6.697 -2.765 -1.005  2.178  9.262 

## Coefficients:
##                     Estimate Std. Error t value   Pr(>|t|)    
## (Intercept)          21.197      1.061  19.976    < 2e-16 ***
## supp.aa              -2.925      1.225  -2.387     0.0222 *  
## dose.2.0              6.365      1.225   5.195   7.72e-06 ***
## ---
## Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

## Residual standard error: 3.875 on 37 degrees of freedom
## Multiple R-squared:  0.469,	Adjusted R-squared:  0.4403 
## F-statistic: 16.34 on 2 and 37 DF,  p-value: 8.202e-06
```



a) Based on the R output above, write the down the estimated main effects equations for predicting the average tooth growth for Guinea pics who (2 points): 

    1) Have supplement type absorbic acid and dosage of 1.0 mg 
    2) Have supplement type absorbic acid and dosage of 2.0 mg 
    3) Have supplement type orange juice and dosage of 1.0 mg 
    4) Have supplement type orange juice and dosage of 2.0 mg 


b) explain the relationship between supplement type and tooth growth in language that can be understood by an average high school student. (2 points)



\pagebreak 

## Problem 7 

```{r echo=TRUE, eval=FALSE}
teeth_SLR_int<-lm(len ~ supp + dose + supp*dose)
summary(teeth_SLR_int)

## Call:
## lm(formula = len ~ supp * dose)

## Residuals:
##    Min     1Q Median     3Q    Max 
## -8.200 -2.337 -0.005  2.147  7.760 

## Coefficients:
##                         Estimate Std. Error   t value   Pr(>|t|)    
## (Intercept)               22.700      1.137    19.969    < 2e-16 ***
## supp.aa                   -5.930      1.608    -3.689    0.00074 ***
## dose.2.0                   3.360      1.608     2.090    0.04374 *  
## supp.aa:dose.2.0           6.010      2.274     2.643    0.01208 *  
## ---
## Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

## Residual standard error: 3.595 on 36 degrees of freedom
## Multiple R-squared:  0.5553,	Adjusted R-squared:  0.5183 
## F-statistic: 14.99 on 3 and 36 DF,  p-value: 1.717e-06
```

a) Based on the R output above, write the down the estimated interaction effects MLR for predicting the average tooth growth for Guinea pics who (2 points): 

    1) Have supplement type absorbic acid and dosage of 1.0 mg 
    2) Have supplement type absorbic acid and dosage of 2.0 mg 
    3) Have supplement type orange juice and dosage of 1.0 mg 
    4) Have supplement type orange juice and dosage of 2.0 mg 



b) explain the relationship between supplement type and tooth growth in language that can be understood by an average high school student. (2 points)




c) Based on the R output above and the residual plots on the next page, which model do you think is a better choice, the one **with** interactions or the one **without** interactions? Justify your answer. (2 points)






\newpage


```{r echo=FALSE}
library("MASS")
teeth_SLR_main<-lm(len ~ supp + dose, ToothGrowth)
teeth_SLR_int<-lm(len ~ supp + dose + supp*dose, ToothGrowth)
resid_data_teeth <- ToothGrowth %>% mutate(resid_main = studres(teeth_SLR_main),
                                 resid_int = studres(teeth_SLR_int),
                                 yhat_main = teeth_SLR_main$fitted.values,
                                 yhat_int = teeth_SLR_int$fitted.values)
plot1 <- ggplot(resid_data_teeth, aes(x=yhat_main, y=resid_main)) +
  geom_point() + 
  geom_hline(yintercept=0) +
  labs(title="Residual plot for main effects model", 
       x="Predicted tooth length", y="Studentized residuals")

plot2 <- ggplot(resid_data_teeth, aes(x=yhat_int, y=resid_int)) +
  geom_point() + 
  geom_hline(yintercept=0) +
  labs(title="Residual plot for interaction effects model", 
       x="Predicted tooth length", y="Studentized residuals")

grid.arrange(plot1, plot2, ncol=2)
```

\newpage 

For Problem 8 consider a MLR model for vehicle fuel consumption, measured in miles per gallon. 

Other attributes of cars like the weight, horsepower, number cylinders, and acceleration time were also recorded for each car. 

We will study the relationship between mpg and weight (in lbs).


```{r echo=FALSE}

mileage_dat <- read_table("mileage.txt", 
                       skip=2, 
                       col_names = c("car", "mpg", "displacement", "weight", "transmission_type"), 
                       cols(transmission_type = col_factor()))  %>% na.omit
#car_dat <- read_csv("auto-mpg.csv")
car_dat <- mileage_dat %>% mutate(log_mpg = log(mpg),
                                  log_wt = log(weight))
#car_dat %>% head
mpg_mod1 <- lm(mpg ~ weight + transmission_type + weight:transmission_type, data=car_dat)
mpg_mod1 %>% summary

mpg_mod2 <- lm(log_mpg ~ weight + transmission_type + weight:transmission_type, data=car_dat)
mpg_mod2 %>% summary

mpg_mod3 <- lm(mpg ~ log_wt + transmission_type + weight:transmission_type, data=car_dat)
#mpg_mod3 %>% summary

mpg_mod4 <- lm(log_mpg ~ log_wt + transmission_type + weight:transmission_type, data=car_dat)
#mpg_mod4 %>% summary

car_dat_full <- car_dat %>% 
                  mutate(resids1 = rstudent(mpg_mod1),
                         fits1 = mpg_mod1$fitted.values,
                         resids2 = rstudent(mpg_mod2), 
                         fits2 = mpg_mod2$fitted.values,
                         resids3 = rstudent(mpg_mod3),
                         fits3 = mpg_mod3$fitted.values,
                         resids4 = rstudent(mpg_mod4), 
                         fits4 = mpg_mod4$fitted.values)
```

```{r}
p1 <- ggplot(car_dat_full, aes(x=fits1, y=resids1)) + 
  geom_point() +
  labs(main = "Model 1", x= "Fitted Values", y="Studentized Residuals")
p2 <- ggplot(car_dat_full, aes(sample=resids1)) + 
  stat_qq() + 
  stat_qq_line() +
  labs(main = "Normal quantile plot", x="Theoretical quantiles", y="Observed residual quantiles")
grid.arrange(p1, p2, ncol=2)
```


```{r}
p3 <- ggplot(car_dat_full, aes(x=fits2, y=resids2)) + 
  geom_point() +
  labs(main = "Model 2", x= "Fitted Values", y="Studentized Residuals")
p4 <- ggplot(car_dat_full, aes(sample=resids2)) + 
  stat_qq() + 
  stat_qq_line() +
  labs(main = "Normal quantile plot", x="Theoretical quantiles", y="Observed residual quantiles")
grid.arrange(p3, p4, ncol=2)
```

```{r eval=FALSE}
p5 <- ggplot(car_dat_full, aes(x=fits3, y=resids3)) + 
  geom_point() +
  labs(main = "Model 3", x= "Fitted Values", y="Studentized Residuals")
p6 <- ggplot(car_dat_full, aes(sample=resids3)) + 
  stat_qq() + 
  stat_qq_line() +
  labs(main = "Normal quantile plot", x="Theoretical quantiles", y="Observed residual quantiles")
grid.arrange(p5, p6, ncol=2)
```

```{r eval=FALSE}
p7 <- ggplot(car_dat_full, aes(x=fits4, y=resids4)) + 
  geom_point() +
  labs(main = "Model 4", x= "Fitted Values", y="Studentized Residuals")
p8 <- ggplot(car_dat_full, aes(sample=resids4)) + 
  stat_qq() + 
  stat_qq_line() +
  labs(main = "Normal quantile plot", x="Theoretical quantiles", y="Observed residual quantiles")
grid.arrange(p7, p8, ncol=2)
```

##  Problem 8


(6pts) Someone argues that a linear regression model would be a good fit. Make a residual plot of ei versus the fitted values. 

What does the plot suggest about the linearity assumption of the regression model? 

(b) (8pts) Apply the log transformation on weight, refit the linear regression model, and produce a new residual plot. What does the plot suggest about the linearity assumption now? What else does it suggest? What assumptions are violated? 

(c) (6pts) Prepare a qq-plot of the residuals in (b). Do the residuals appear to be Normally distributed?



(5pts) How do you interpret the estimated intercept and slope? 

(b) (10pts) Test whether or not there is a linear association between mpg (after the transformation you selected, if any) and weight (after the transformation you selected, if any), using alpha= 0.05. State the alternative hypothesis, decision rule, and conclusion. What is the p-value of the test? (c) (5pts) Find a 90% confidence interval for beta1. How do you interpret it?

