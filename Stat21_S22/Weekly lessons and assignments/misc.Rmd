---
title: "R Notebook"
output: html_notebook
---



---
# Resources for learning to program in R 

- Google is your friend! (and Stack Exchange, etc.)
- R for Data Science (free online textbook) https://r4ds.had.co.nz/



---
# CLT Simulation Exercise

**To do:** 

Open the CLT_Example.R file in Moodle. (Only one group member needs to do this and can share their screen). Answer the questions presented within the R comments (the #'s) at the end of the file. 


---
# HW 1 Problem 5
## Sampling Distributions

**With your group:** Have everyone do an internet search for the term "sampling distribution". Then spend a few minutes discussing what this term means. The questioner should pay careful attention and ask follow-up questions to the proposed/found definitions. The recorder should take note of any unanswered questions and the reporter should be prepared to communicate any answers or unanswered questions back to the class. 



## week 2-2

---
# Example
## Inference for a proportion 

In New York City on October 23rd, 2014, a doctor who had recently been treating Ebola patients in Guinea went to the hospital with a slight fever and was subsequently diagnosed with Ebola. Soon after, a survey conducted by the Marist Poll, an organization with a carefully designed methodology for drawing random samples from identified populations, found that, out of a sample of size $1042$, $82\%$ of New Yorkers favored a "mandatory 21-day quarantine for anyone who has come in contact with an Ebola patient."

.footnote[Introductory Statistics for the Life and Biomedical Sciences by Julie Vu and David Harrington.]

---
# Example
## Inference for a proportion 

**To do:** 

a) Verify that the sampling distribution of $\hat{p}$ is nearly normal.

b) Construct a $95\%$ confidence interval for $p$, the proportion of New York adults who supported a quarantine for anyone who has come into contact with an Ebola patient. Specifically state the values of $\hat{p}_{obs}$, $z_{\alpha/2}^*$, and $SE(\hat{p})$.  


--
.scroll-small[
```{r}
obs_success <- 1042*0.82
sample_size <- 1042
prop.test(obs_success, sample_size, conf.level = 0.95)
```
]

---
# Example
## Inference for a proportion 

**To do:** 

a) Verify that the sampling distribution of $\hat{p}$ is nearly normal.

b) Construct a $95\%$ confidence interval for $p$, the proportion of New York adults who supported a quarantine for anyone who has come into contact with an Ebola patient. Specifically state the values of $\hat{p}_{obs}$, $z_{\alpha/2}^*$, and $SE(\hat{p})$.  

c) Conduct an $\alpha=0.05$ hypothesis test to answer the question: Do the majority of New York adults support the mandatory quarantine? 


--
.scroll-small[
```{r}
prop.test(obs_success, sample_size, alternative="greater", conf.level = 0.95)
```
]


---
# HW 1 Problem 9
## Inference for the difference of proportions 

.scroll-output[It is widely believed that regular mammogram screening may detect breast cancer early, resulting in fewer deaths from that disease. One study that investigated this issue over a period of 18 years was published during the 1970s. Among $30,565$ people with breast tissue who had never had mammograms, $196$ died of breast cancer, while only $153$ of $30,131$ who had undergone screening died of breast cancer.

**With your group** write down a null and alternative hypothesis to test to determine if mammograms are an effective screening tool for reducing breast cancer fatalities. Then use the R code template below to evaluate this hypothesis at any significance level you'd like. The reporter should be prepared to share your conclusion with the class and/or share any unanswered questions. 

The recorder should share a screenshot of your R code (not the output, just the code) with me on Slack.

**Hint:**
```{r eval=FALSE}
obs_success_group1 <- ?
obs_success_group2 <- ?
sample_size_group1 <- ?
sample_size_group2 <- ?
prop.test(c(obs_success_group1, obs_success_group2), 
          c(sample_size_group1, sample_size_group2), ... )
```
]








Gradescope 

+ Uploading and selecting pages with answers https://youtu.be/KMPoby5g_nE?t=8.

+ Understanding scoring: some questions may be graded for completion and others will be graded for correctness. I will let you know which problems this corresponds to after the due date.  
  
  

Incorportating handwritten answers 
+ CamScanner (https://www.camscanner.com/) 
+ Merge the PDF of your work in RStudio with a PDF version of the image from CamScanner. 
+ Submit the entire merged PDF to Gradescope, paying close attention to which questions go with the hand written parts. 



Let's consider the data set called *msleep* which is contained in the R package `ggplot2`. 

```{r}
library(ggplot2)
head(msleep)
```

This data set looks at the amount of time spent sleeping for different mammals and records other factors such as brain and body weight of these animals. Suppose we are interested in the total amount of sleep an animal gets (variable name `sleep_total`) as predicted by the total body weight of the animal (variable name `bodywt`).


a) There is a qualitative variable named *order* in this data set. Fit two separate linear regression models for the animals of *order* "Carnivora" and of *order* "Primates". Report the estimated regression equations and print the summary of the two linear models.


b) What is the estimate of the variance of the random error for each of these two models? 


c) Do you think we should combine the data and just fit a single linear regression model to both *orders* Carnivora and Primates? Justify your answer with 1-2 sentences and (possibly) a supporting plot.






## Problem 12

(a) Make a residual plot for the regression model you fit in Problem 5. Are there any apparent violations of the regression model assumptions? Explain your answer in four sentences or less. 


(b) Make a Normal probability plot of the standardized residuals to determine if the residuals look like they come from a Normal distribution. Interpret the plot in three sentences or less.  



## Problem 13

(a) Calculate a $95\%$ confidence interval for the model parameter $\beta_1$, the slope of the variable `floors`. How would you explain the meaning of this confidence interval, in the specific context of this data set, to an architect who has never taken a statistics class?


(b) Test the hypothesis that $\beta_1 = 0$ at an $\alpha=0.05$ significance level. State your null and alternative hypotheses and report the test statistic and p-value. Interpret, in the context of the problem, the results of this test in two sentences or less. 


## Problem 8

(a) Suppose a developer is working on a new building that has taken the 15 years to get the go-ahead. Suppose they are cheekily designing the building to have 15 floors, one for each year of struggle to get the building approved. If the architect needs to know how tall this building may be, would you report to them a prediction interval or a confidence interval? Justify your answer in three sentences or less. 


(b) Create a scatter plot of the observed data and overlay on this plot the estimated regression line and the confidence and prediction bands. 


## Problem 9

Note that there is a categorical variable called "purpose" included in the data set. Suppose we are interested in determining if there is a significant difference in the average height of a building depending on its purpose. Using `height` (in meters) as the response and purpose as the explanatory variable, fit an ANOVA model to this data after excluding the data point for the only hospital (see code below). What does the result of the ANOVA F-test indicate? 

```{r}
skyscrapers_edit <- skyscrapers %>% filter(!(purpose=="hospital"))
```


## Problem 10

We know that the significance level ($\alpha$) represents the probability of a false positive (i.e. a type I error) in a hypothesis test. Related to this concept is the probability of correctly detecting a positive. In statistics, this probability is called the **power** of a test and is often denoted as $1-\beta$ where $\beta$ is the probability of a type II error. (Hence the power of a test is the probability of NOT making a type II error.) What if we wanted to collect more skyscraper data to increase the power of our test in Problem 9? Using this example as a guide: https://stats.idre.ucla.edu/r/dae/one-way-anova-power-analysis/ and assuming we can collect enough data so that all categories for the variable `purpose` have the same number of observations (i.e. we have a balanced ANOVA design), how many more observations of hospitals, hotels, offices, and residential buildings specifically do we need to achieve 85% power? 


\pagebreak

## Bonus Problem 

For $+ 2$ additional possible homework points, answer the following questions regarding Problems 7-10 from HW 4.   

(a) What is the predictor variable and what is the response variable for this statistical model? 

(b) Without standardizing the response variable, what are the p-value for the ANOVA F-test and the MSE based on this ANOVA model?  

(c) Without standardizing the response variable, display the Normal probability plot for states without any voter ID laws. 

Now create a new data object called `voter_turnout2` that contains a third column called `turnout_rate_std` that corresponds to the standardized version of `turnout_rate`. 

(d) Using `turnout_rate_std` as the response variable, what are the p-value for the ANOVA F-test and the MSE based on this ANOVA model?  

(e) Using `turnout_rate_std` as the response variable, display the Normal probability plot for states without any voter ID laws. 

(f) Compare your answers from parts (b) and (c) to parts (d) and (e). Briefly explain any differences or similarities you see. 
  
  
  

### HW 4 setting: 

The increase in the passage of voter identification laws (“Voter ID”) has been labelled as a push to reduce fraudulent or illegal voting in the United States. Most of these laws have come into effect by requiring voters to present a photo ID either at time of registration or at the time of voting. The National Conference of State Legislatures (NCSL) identified four different levels of voter identification requirements: Strict Photo ID Law, Non-Strict Photo ID, Strict Non-Photo ID Law, and NonStrict Non-Photo ID. Non-strict identification laws are defined as “at least some voters without acceptable identification have an option to cast a ballot that will be counted without further action on the part of the voter”. Strict identification laws are defined as “voters without acceptable identification must vote on a provisional ballot and also take additional steps after Election Day for it to be counted.” 

In 2004, not a single state enforced a photo identification requirement at the polls, but since then the numbers have increased drastically. Although designed to reduce fraudulent voting, several studies have found that there are a very small number of fraudulent votes to begin with, so the laws have very little impact. Rather, these laws have acted to raise the costs of voting and reduce convenience, especially for certain groups of voters who are unlikely to have a photo ID.  

The following (real) data set contains information on what level of voter identification law was in place for each state in the 2016 US presidential election (no low, non-strict non-photo ID law, strict non-photo ID law, non-strict photo ID law, strict photo ID law) and what was the percentage of voter turnout for each state that year. (No law states do not require a government issued ID in order to submit a ballot.)

```{r}
voter_turnout <- tibble(law_type = c(rep("No law",18),
                                 rep("Non-strict non-photo", 14),
                                 rep("Strict non-photo",2),
                                 rep("Non-strict photo",8),
                                 rep("Strict photo",8)),
                   turnout_rate = c(52.8,56.5,61.6,68.4,70.7,66.4,67.2,74.1,62.8,57.4,64.4,
                                    54.5,56.8,64.5,66.2,63.6,63.7,59.5,50.2,64.7,56.8,
                                    52.3,60.8,71.4,61.8,62.2,58.6,64.2,63.7,70,61,54.9,56.7,
                                    62.9,51.4,58.6,59.1,64.7,60,59.2,42.3,64.5,
                                    69.5,66.1,51.1,55.2,57.7,56.4,59.1,58.8))
```




## Problem 11


The following data set was collected in 2018-2019 and recorded different attributes of skyscrapers in NYC. In Problems 5-10 we are going to investigate how the height (in meters) $(Y)$ of a skyscraper depends on the number of stories (i.e. floors) it has $(x)$. 

```{r}
skyscrapers <- read_csv(
                url("http://www.swarthmore.edu/NatSci/sthornt1/DataFiles/skyscraper_data.csv"))
head(skyscrapers)
```



Make a scatter plot of the observed predictor and response variables and report

(a) The estimated regression equation.

(b) The value of the standard deviation of height.

(c) The value of R-squared.



---
# Statistical Assumptions 

Typically, when we collect a *sample* of data and preform a statistical analysis, it is because we wish to understand some underlying property of the *population* as a whole. For all of the methods we will use in this class (and for the most statistical methods in general) this means we always need to assume that 

- The sample is representative of the population and  

  * Sampling strategies 
  
  * Possible sources of bias? 

- The observations within our sample were drawn independently of one another. 

  * 10% Condition (useful when population is relatively small)
  
  * Other sources of dependency?


--
Any time we draw statistical conclusions from a sample of data, the quality of our conclusions depends on the quality of the data. The quality of our conclusions also depends on the appropriateness of any statistical assumptions. 

In real life, there is always going to be subjectivity in drawing statistical conclusions because of this. The American Statistical Association has published some guidelines for ethical statistical practice. 


---
# American Statistical Association
## Guidelines for the Integrity of Data and Methods

.scroll-output[
1. Acknowledges statistical and substantive assumptions made in the execution and interpretation of any analysis. When reporting on the validity of data used, acknowledges data editing procedures, including any imputation and missing data mechanisms.

2. Reports the limitations of statistical inference and possible sources of error.

3. In publications, reports, or testimony, identifies who is responsible for the statistical work if it would not otherwise be apparent.

4. Reports the sources and assessed adequacy of the data, accounts for all data considered in a study, and explains the sample(s) actually used.

5. Clearly and fully reports the steps taken to preserve data integrity and valid results.

6. Where appropriate, addresses potential confounding variables not included in the study.

7. In publications and reports, conveys the findings in ways that are both honest and meaningful to the user/reader. This includes tables, models, and graphics.

8. In publications or testimony, identifies the ultimate financial sponsor of the study, the stated purpose, and the intended use of the study results.

9. When reporting analyses of volunteer data or other data that may not be
representative of a defined population, includes appropriate disclaimers and, if used, appropriate weighting.

10. To aid peer review and replication, shares the data used in the analyses whenever possible/allowable and exercises due caution to protect proprietary and confidential data, including all data that might inappropriately reveal respondent identities.

11. Strives to promptly correct any errors discovered while producing the final report or after publication. As appropriate, disseminates the correction publicly or to others relying on the results.]


---
# Basic Statistical Assumptions 
## The Integrity of Data and Methods - Real Example 

[A mathematician signs an affidavit](http://www.swarthmore.edu/NatSci/sthornt1/Stat021/S2021/miller_affidavit.pdf) - .blue[For this exercise, don't look at the next slide before you complete these questions!]

**With your group** browse through the affidavit and answer the following questions. 

1. What statistical procedure is this mathematician using? 

2. What are the assumptions necessary for his conclusion to be reliable? 

3. What information does this statement provide about how the data was collected? 


.scroll-small[**Group roles:**

- Recorder - Open the affidavit and share your screen with your group. Keep track of your group's answers to the three questions above. When there is 1 min remaining, share your answers with me via a DM on Slack. 

- Reporter - Keep track of your group's progress on the Google spreadsheet and be prepared to discuss your group's answers (or any additional questions) with the class.  

- Questioner - Make sure you *ask at least one* additional question to your group about your responses to the questions above. ]





---
# Basic Statistical Assumptions 
## The Integrity of Data and Methods - Real Example 

Take 5 mins to read through this [statistician's response](https://williamsrecord.com/435109/opinions/a-rebuttal-to-steven-millers-report-on-pa-gop-mail-in-ballot-requests/) to the study. (For those of you who are interested, you can read more about this [here](https://williamsrecord.com/434506/news/professor-of-mathematics-steven-miller-issues-legal-statement-suggesting-ballot-irregularities-in-pa-conclusi).)


.scroll-output[**With your group** discuss the following questions: 

- How would you improve upon this study? 

- What would you do differently? 

- Design a survey that avoids the issues with this one. 



## Problem 2 

Student's investigating the packaging of potato chips purchased 6 bags of Lay's Ruffles marked with a net weight of 28.3 grams. They carefully weighed the contents of each bag, recording the following weights (in grams): 29.3, 28.2, 29.1, 28.7, 28.9, 28.5 We want to test whether or not the net weight of these chips is different from 28.3 g. 


**What is the unknown population parameter?**

&nbsp;
&nbsp;
&nbsp;

**What is the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**What is the sampling distribution of the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**Which procedure should we use?**

&nbsp;
&nbsp;
&nbsp;

**Which assumptions do we need to check?**
&nbsp;
&nbsp;
&nbsp;


## Problem 3 

In a 2017 online Gallup poll of 18620 participants, when asked "Do you share news stories mostly with people who have views similar to your own or mostly with people whose views differ from your own?", $70\%$ of the respondents replied "Similar views" while the other $30\%$ replied "Different views". We want to find a $90\%$ confidence interval for the proportion of all US adults that share new stories with people having the same view as themselves. 


**What is the unknown population parameter?**

&nbsp;
&nbsp;
&nbsp;

**What is the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**What is the sampling distribution of the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**Which procedure should we use?**

&nbsp;
&nbsp;
&nbsp;

**Which assumptions do we need to check?**
&nbsp;
&nbsp;
&nbsp;

\pagebreak

## Problem 4 

The College Board reported that $60\%$ of all students who took the 2004 AP Statistics exam earned scores of 3 or higher. One teacher wondered if the performance of her school was different. She believed that year's students to by typical of those who will take AP Stats at her school and was pleased when $65\%$ of her 54 students achieved scores of 3 or better. We want to assess her claim that her school is different with either a confidence interval or a hypothesis test. 


**What is the unknown population parameter?**

&nbsp;
&nbsp;
&nbsp;

**What is the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**What is the sampling distribution of the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**Which procedure should we use?**

&nbsp;
&nbsp;
&nbsp;

**Which assumptions do we need to check?**
&nbsp;
&nbsp;
&nbsp;


## Problem 6 

American League baseball teams play their games with the designated hitter rule, meaning that pitchers do not bat. The league believes that replacing the pitcher, traditionally a weak hitter, with another player in the batting order produces more runs and generates more interest among fans. Below are the average numbers of runs score in American League and National League stadiums for the first half of the 2001 season. 

**American:** 11.1, 10.8, 10.8, 10.3, 10.3, 10.1,10.0, 9.5, 9.4, 9.3, 9.2, 9.2, 9.0, 8.3

**National:** 14.0, 11.6, 10.4, 10.3, 10.2, 9.5, 9.5, 9.5, 9.5, 9.1, 8.8, 8.4, 8.3, 8.2, 8.1, 7.9 

We want to determine if the 14 runs scored per game at Coors is unusual but we do not want to use two separate confidence intervals to determine whether the two leagues differ in average number of runs scored. 


**What is the unknown population parameter?**

&nbsp;
&nbsp;
&nbsp;

**What is the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**What is the sampling distribution of the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**Which procedure should we use?**

&nbsp;
&nbsp;
&nbsp;

**Which assumptions do we need to check?**
&nbsp;
&nbsp;
&nbsp;

\pagebreak

## Problem 7 

Having done poorly on their Biology final exams in June, six students repeat the course in summer school and take another exam in August. If we consider these students to be representative of all students who might attend this summer school in other years, how can we determine if these results provide evidence that the program is worthwhile? 

**Person:** Aaron, Brittney, Chloe, Drake, Edward, Frankie

**June scores:** 54, 49, 68, 66, 62, 62  

**August scores:** 50, 65, 74, 64, 68, 72


**What is the unknown population parameter?**

&nbsp;
&nbsp;
&nbsp;

**What is the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**What is the sampling distribution of the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**Which procedure should we use?**

&nbsp;
&nbsp;
&nbsp;

**Which assumptions do we need to check?**
&nbsp;
&nbsp;
&nbsp;


## Problem 9 

A survey of $430$ randomly chosen college students found that $21\%$ of the 222 full-time students and $18\%$ of the 208 part-time students had purchased books in person from their campus book store. We want to determine if there is sufficient statistical evidence that full-time students are more likely than part-time students to purchase their books in person (rather than online)? 


**What is the unknown population parameter?**

&nbsp;
&nbsp;
&nbsp;

**What is the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**What is the sampling distribution of the sample estimate?**

&nbsp;
&nbsp;
&nbsp;

**Which procedure should we use?**

&nbsp;
&nbsp;
&nbsp;

**Which assumptions do we need to check?**
&nbsp;
&nbsp;
&nbsp;



---

### For a single numeric variable, we visualize the values from our sample with bar charts. 


---

### For a numeric and a qualitative variable, we visualize the values from our sample with box plots. 



---
## Plotting in the `tidyverse`
### Box plots

.scroll-output[
If we treat the variable `passengers` as a categorical variable, we would view this data with box plots instead of as a scatter plot. 

```{r echo=TRUE, eval=FALSE}
ggplot(car_data, aes(x=mph, y = passengers)) +
         geom_boxplot() +
         labs(title="Scatter plot") + 
         xlab("Miles per hour") + 
         ylab("Number of passengers")
```
]

---
## Plotting in the `tidyverse`
### Box plots


```{r echo=FALSE, eval=TRUE, fig.align='center', fig.height=3}
ggplot(car_data, aes(x=mph, y = passengers)) +
         geom_boxplot() +
         labs(title="Scatter plot") + 
         xlab("Miles per hour") + 
         ylab("Number of passengers")
```
