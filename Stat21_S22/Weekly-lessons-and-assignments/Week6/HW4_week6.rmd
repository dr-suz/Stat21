---
title: "Stat 21 Homework 4"
author: ' Person 1, Person 3, etc '
date: 'Due: Sunday, Feb 27th by midnight'
output:
  pdf_document:
    toc: yes
  html_document:
    code_folding: show
    toc: yes
    toc_float: yes
urlcolor: blue
---

```{asis, directions=TRUE}
Use this file as the template for your submission. Do not delete anything from this template unless you are prompted to do so (e.g. where to write your name above, where to write your solutions or code below). Make sure you have installed the following packages in your version of RStudio: `tidyverse`, `knitr` __before__ you attempt to knit this document.

Your completed assignment should be submitted as a single __PDF__ using the link under Week 3 titled "Submit HW 4 to Gradescope". You must use R markdown to write up your solutions. For any homework problems that involve coding in R, you must provide __both__ the code and a written answer interpreting the output within the context of the problem. You are allowed to work with your classmates on this homework assignment but you are expected to write up your own solutions. Every answer must be supported by a written statement unless otherwise specified. *A good rule of thumb is to make sure your answer is understandable to someone who hasn't read the problem question (or code output associated with it).* 

**Additionally**, make sure that when you upload your solutions to Gradescope, you select which pages go correspond with which questions. Also, check to make sure that your knitted homework document is not uploaded as an extra-long single page document. Failure to do these things will result in a penalty on your homework grade. Finally, I strongly recommend that you address and resolve any knitting or R coding issues before Saturday as solutions to any R-coding questions that are not knitted properly will not receive any credit. 
```


```{r setup, include=FALSE}
###########################
# DEFAULT SETTINGS
###########################
knitr::opts_chunk$set(message = FALSE) 
knitr::opts_chunk$set(warning = FALSE)  
knitr::opts_chunk$set(echo=TRUE)     
knitr::opts_chunk$set(eval=TRUE)     

###########################
# LIBRARIES
###########################
library(tidyverse)
library(knitr)
library(Stat2Data) 
```


# Part I: Non-R Problems

**1.** Suppose we conduct a t-test for the slope of a linear regression model and fail to reject the null hypothesis that $H_0: \beta_1=0$. In this case, the data supports modeling the response variable as 
$$ Y = \beta_0 + \epsilon.$$
In this case, what is the least squares estimator $\hat{\beta}_0$? Show your work and/or explain your reasoning. 

**Solution:** [Write your solution here.]


***
The next two problems are meant to clarify a mistake I made in class when discussing how to interpret the coefficients of a regression model for a transformed response. Work through these mathematical problems carefully and compare your answers to your notes from class to identify what the mistake was and how to correct it.  

For problems 2 and 3, recall the SLR model we fit to model the average  number of surviving bacteria in a canned food product and the minutes of exposure to 300 degree Fahrenheit heat. (Note: Do not copy/paste Greek letters into this document of you will not be able to knit your solutions. You may write out mathematical equations by hand and attach an image of your solutions to your final PDF or you may simply write out equations with regular text. For example: Y_hat = 3.3 - 0.98X) 

## Problem 2 

(a) Write out the estimated regression equation for the original data where the number of surviving bacteria is the response and the minutes of exposure, $x$, is the predictor. 

(b) Now, suppose we add one minute of exposure, $x+1$, and write out the estimated regression equation for the original data with the number of surviving bacteria as the response and the minutes of exposure is the predictor. 

(c) What is the difference between the two equations in (a) and (b) and how do we interpret this difference? (Hint: Take the equation from part (b) and subtract the equation in part (a).)

**Solution:** 

(a) [Write your solution here.]

(b) [Write your solution here.]

(c) [Write your solution here.]


## Problem 3 

(a) Write out the estimated regression equation for the (natural) logarithm of the number of surviving bacteria as the response and the minutes of exposure, $x$, as the predictor in the original units of the response. (E.g if we modeled $log(y) = b + ax$ then this is equivalent to modeling $y = e^{log(y)}=e^{b + ax}$.)

(b) Now, suppose we add one minute of exposure, $x+1$, and write out the estimated regression equation for the (natural) logarithm of the number of surviving bacteria as the response and the minutes of exposure as the predictor. 

(c) What is the ratio between the two equations in (a) and (b) and how do we interpret this? (Hint: Take the equation from part (b) and divide by the equation in part (a).)

**Solution:** 

(a) [Write your solution here.]

(b) [Write your solution here.]

(c) [Write your solution here.]




# Part II: R Problems 

## Problem 4 

The following chunks of code outlines a simulation study regarding confidence intervals for a SLR model. In this problem, we will consider a true (not estimated) regression equation of 

$$y = 50 + 10x + \epsilon, \quad \text{where } \epsilon \sim N(0,16)$$

and we will generate 500 repeated samples of $n=20$ observations drawing one observation for each level of $x=1,1.5,2, \dots, 10$ for each sample. 

**Part 1:** For each sample, the code below computes the least-squares estimates of the slope and intercept.
```{r} 
## Initialization 
set.seed(1001)  
remove(list=ls())
x <- seq(0.5, 10, by=0.5)

## Regression equation 
generate.response <- function(x){
  y <- 50 + 10*x + rnorm(20, mean=0, sd=4)
  return(y)
}
y_mtx <- matrix(rep(x, 500), ncol=500, byrow=FALSE)
y_mtx <- apply(y_mtx, 2, generate.response)

## Least squares estimates
estimate.parameters <- function(response, predictor=x){
  mod = lm(response ~ predictor)
  beta0_hat = mod$coefficients[1]
  beta1_hat = mod$coefficients[2]
  return(c(beta0_hat, beta1_hat))
}

estimated_betas <- matrix(rep(NA,500*2), ncol=2)
colnames(estimated_betas) <- c("beta0_hat", "beta1_hat")
for(k in 1:500){
  estimated_betas[k,] = estimate.parameters(y_mtx[ ,k])
}
estimated_betas <- data.frame(estimated_betas)
estimated_betas ## Please make sure this line is commented out before your knit your solutions to hand in!
names(estimated_betas)
```

(a) Construct histograms of the sample vlaues of $\hat{\beta}_0$ and $\hat{\beta}_1$ (the estimated_betas) by uncommenting the code below and filling in the question marks. Discuss the shape of these histograms. 

```{r}
#ggplot(estimated_betas, aes(x=???)) + 
#  geom_histogram(bins=40) + 
#  labs(title= "Histogram of ???", x = "???", y = "???")


#ggplot(estimated_betas, aes(x=???)) + 
#  geom_histogram(bins=40) + 
#  labs(title= "Histogram of ???", x = "???", y = "???")
```

**Solution**: [Discuss your answer to part (a) here.]


**Part 2:** For each sample, the code below computes an estimate of $\hat{y}$ for $x=5$. 
```{r}
## Predicting Y values
estimate.observation <- function(response,predictor=x){
  mod <- lm(response ~ predictor)
  y_hat <- mod$coefficients[1] + mod$coefficients[2]*5
  return(y_hat=y_hat)
}

y_hat <- rep(NA,500)
for(k in 1:500){
  y_hat[k] = estimate.observation(y_mtx[ ,k])
}
y_hats <- data.frame(y_hat)
y_hats ## Please make sure this line is commented out before your knit your solutions to hand in!
```

(b) Construct a histogram of the estimates you obtained (the 500 y_hat values). Discuss the shape of the histogram 

```{r}
#ggplot(y_hats, aes(x=???)) + 
#  geom_histogram(bins=40) + 
#  labs(title= "Histogram of ???", x = "???", y = "???")
```

**Solution**: [Discuss your answer to part (b) here.]

**Part 3:** For each sample, the code below compute a $95\%$ CI on the slope, $\beta_1$

```{r}
## CI for slope of predictor
CI.slope <- function(response,predictor=x){
  mod <- lm(response ~ predictor)
  t_crit <- qt(0.05/2, df=20-2, lower.tail=FALSE)
  se_beta1 <- summary(mod)$coefficients[2,2] ##?
  beta1_hat <- mod$coefficients[2]
  LB <- beta1_hat - t_crit*se_beta1
  UB <- beta1_hat + t_crit*se_beta1
  return(c(LB, UB))
}

LB_slope <- rep(NA,500)
UB_slope <- rep(NA, 500)
for(k in 1:500){
  conf_int = CI.slope(y_mtx[ ,k])
  LB_slope[k] = conf_int[1]
  UB_slope[k] = conf_int[2]
}
CI_slope <- tibble(LB_slope,UB_slope) 
CI_slope ## Please make sure this line is commented out before your knit your solutions to hand in!
```

(c) Use the next two lines of code to determine how many of these intervals contain the true value $\beta_1=10$? Is this what you would expect?
```{r}
#((CI_slope$LB_slope<=10)&(CI_slope$UB_slope>=10))  ## Please make sure this line is commented out before your knit your solutions to hand in!
#sum((CI_slope$LB_slope<=10)&(CI_slope$UB_slope>=10))
```

**Solution**: [Discuss your answer to part (c) here.]

**Part 4:** For each estimate of $\hat{y}$ for $x=5$ in part 2, the code below computes the $95\%$ CI for the mean response. 
```{r}
## CI for mean response 
CI.mean.response <- function(response,predictor=x){
  dat <- data.frame(response, predictor)
  remove(list=c("response","predictor"))
  mod <- lm(response ~ predictor, dat)
  y_hat <- data.frame(response = mod$coefficients[1] + mod$coefficients[2]*5, predictor=5)
  PI <- predict(mod, y_hat, interval="confidence", level = 0.95)
  return(c(PI[2], PI[3]))
}

LB_mean_response <- rep(NA,500)
UB_mean_response <- rep(NA, 500)
for(k in 1:500){
  conf_int = CI.mean.response(y_mtx[ ,k])
  LB_mean_response[k] = conf_int[1]
  UB_mean_response[k] = conf_int[2]
}
CI_mean_y = tibble(LB_mean_response,UB_mean_response)
CI_mean_y ## Please make sure this line is commented out before your knit your solutions to hand in!
```

(d) Use the next two lines of code to determine how many of these intervals contain the true value of $E[Y \mid x=5]=100$? Is this what you would expect? 
```{r}
#((CI_mean_y$LB_mean_response<=100)&(CI_mean_y$UB_mean_response>=100)) ## Please make sure this line is commented out before your knit your solutions to hand in!
#sum((CI_mean_y$LB_mean_response<=100)&(CI_mean_y$UB_mean_response>=100))
```

**Solution**: [Discuss your answer to part (d) here.]




***

The following data set was collected in 2018-2019 and recorded different attributes of skyscrapers in NYC. In Problems 5-10 we are going to investigate how the height (in meters) $(Y)$ of a skyscraper depends on the number of stories (i.e. floors) it has $(x)$. 

```{r}
skyscraper_data <- read.delim("skyscraper_data.txt")
head(skyscraper_data)
```


## Problem 5

Make a scatter plot of the observed predictor and response variables and report

(a) The estimated regression equation.

(b) The value of the standard deviation of height.

(c) The value of R-squared.


```{r}
## Erase this line and replace with your code for Problem 5
```

**Solution:** [Write your solution here.]



## Problem 6

(a) Make a residual plot for the regression model you fit in Problem 5. Are there any apparent violations of the regression model assumptions? Explain your answer in four sentences or less. 


(b) Make a Normal probability plot of the standardized residuals to determine if the residuals look like they come from a Normal distribution. Interpret the plot in three sentences or less.  

```{r}
## Erase this line and replace with your code for Problem 6
```

**Solution:** [Write your solution here.]

## Problem 7

(a) Calculate a $95\%$ confidence interval for the model parameter $\beta_1$, the slope of the variable `floors`. How would you explain the meaning of this confidence interval, in the specific context of this data set, to an architect who has never taken a statistics class?


(b) Test the hypothesis that $\beta_1 = 0$ at an $\alpha=0.05$ significance level. State your null and alternative hypotheses and report the test statistic and p-value. Interpret, in the context of the problem, the results of this test in two sentences or less. 

```{r}
## Erase this line and replace with your code for Problem 7
```

**Solution:** [Write your solution here.]


## Problem 8

Suppose a developer is working on a new building that has taken the 15 years to get the go-ahead. Suppose they are cheekily designing the building to have 15 floors, one for each year of struggle to get the building approved. If the architect needs to know how tall this building may be, would you report to them a prediction interval or a confidence interval? Justify your answer in three sentences or less. 

```{r}
## Erase this line and replace with your code for Problem 8
```

**Solution:** [Write your solution here.]


## Problem 9 

Create a scatter plot of the observed data and overlay on this plot the estimated regression line and the confidence and prediction bands. Write 1-2 sentences describing what you see in this plot.

```{r}
## Erase this line and replace with your code for Problem 9
```
**Solution:** [Write your solution here.]

## Problem 10

Which assumptions are required to answer each of the previous four questions? Based on your analysis thus far, which assumptions seem most reasonable and are there any that you suspect are not strongly supported in this example? (Note: This is not really an R-coding problem.)

**Solution:** [Write your solution here.] 




